(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{1019:function(e,t,n){"use strict";var i=n(58),a=n(0),r=n.n(a),o=n(1),s=n.n(o),u=n(17),c=n.n(u),l=n(16),p=n(241),d=n(608),f=n(13),m=n(6),v=n.n(m),h=n(34),y=(n(1043),n(252)),g=n(7),b=n.n(g),S=n(28),w=n.n(S),I=(0,b.a.import)("util/scrollToIndex"),D=l.b.redux.actions.setViewportSpecificData,E=Object(i.b)((function(e){var t=e.viewports,n=(t.viewportSpecificData[t.activeViewportIndex]||{}).cine;return{activeEnabledElement:y.a.runCommand("getActiveViewportEnabledElement"),activeViewportCineData:n||{isPlaying:!1,cineFrameRate:24},activeViewportIndex:e.viewports.activeViewportIndex}}),(function(e){return{dispatchSetViewportSpecificData:function(t,n){e(D(t,n))}}}),(function(e,t,n){var i=e.activeEnabledElement,a=e.activeViewportCineData,r=e.activeViewportIndex;return{cineFrameRate:a.cineFrameRate,isPlaying:a.isPlaying,onPlayPauseChanged:function(e){var n=w()(a);n.isPlaying=!n.isPlaying,t.dispatchSetViewportSpecificData(r,{cine:n})},onFrameRateChanged:function(e){var n=w()(a);n.cineFrameRate=e,t.dispatchSetViewportSpecificData(r,{cine:n})},onClickNextButton:function(){var e=b.a.getToolState(i,"stack");if(e&&e.data&&e.data.length){var t=e.data[0],n=t.currentImageIdIndex;n>=t.imageIds.length-1||I(i,n+1)}},onClickBackButton:function(){var e=b.a.getToolState(i,"stack");if(e&&e.data&&e.data.length){var t=e.data[0].currentImageIdIndex;0!==t&&I(i,t-1)}},onClickSkipToStart:function(){var e=b.a.getToolState(i,"stack");e&&e.data&&e.data.length&&I(i,0)},onClickSkipToEnd:function(){var e=b.a.getToolState(i,"stack");if(e&&e.data&&e.data.length){var t=e.data[0].imageIds.length-1;I(i,t)}}}}))(f.b),O=l.b.redux.actions,C=O.setLayout,x=O.setViewportActive,P=(Object(i.b)((function(e){return{currentLayout:e.viewports.layout,activeViewportIndex:e.viewports.activeViewportIndex}}),(function(e){return{onChange:function(t,n,i){for(var a=[],r=t.row+1,o=t.col+1,s=r*o,u=0;u<s;u++){var c=n.viewports[u],l=c&&c.plugin;c&&c.vtk&&(l="cornerstone"),a.push({plugin:l})}var p={numRows:r,numColumns:o,viewports:a};i>s-1&&e(x(0)),e(C(p))}}}),(function(e,t){var n=t.onChange,i=e.currentLayout,a=e.activeViewportIndex;return{onChange:function(e){return n(e,i,a)}}}))(f.i),n(76));function U(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function V(e){return(V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function T(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function R(e){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function k(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function j(e,t){return(j=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function A(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var M=function(e){function t(e){var n,i,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i=this,a=R(t).call(this,e),n=!a||"object"!==V(a)&&"function"!=typeof a?k(i):a,A(k(n),"closeCineDialogIfNotApplicable",(function(){var e=n.props.dialog,t=n.state,i=t.dialogId,a=t.activeButtons,r=t.toolbarButtons;i&&(r.find((function(e){return e.options&&"CINE"===e.options.behavior}))||(e.dismiss({id:i}),a=a.filter((function(e){return e.options&&"CINE"!==e.options.behavior})),n.setState({dialogId:null,activeButtons:a})))}));var r=z.call(k(n));return n.state={toolbarButtons:r,activeButtons:[]},n.seriesPerStudyCount=[],n._handleBuiltIn=F.bind(k(n)),n.updateButtonGroups(),n}var n,i,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&j(e,t)}(t,e),n=t,(i=[{key:"updateButtonGroups",value:function(){var e=this,t=y.c.modules[d.a.PANEL];this.buttonGroups={left:[],right:[]},t.forEach((function(t){var n=t.module,i=Array.from(n.defaultContext);n.menuOptions.forEach((function(t){var n=Array.from(t.context||i),a=e.props.activeContexts.some((function(e){return n.includes(e)})),r="function"==typeof t.isDisabled&&t.isDisabled(e.props.studies,e.props.activeViewport);if(a&&!r){var o={value:t.target,icon:t.icon,bottomLabel:t.label},s=t.from||"right";e.buttonGroups[s].push(o)}}))})),this.buttonGroups.left.unshift({value:"studies",icon:"th-large",bottomLabel:this.props.t("Series")})}},{key:"componentDidUpdate",value:function(e){var t=e.activeContexts!==this.props.activeContexts,n=e.studies,i=e.activeViewport,a=this.props.activeViewport,r=this.props.studies,o=this.seriesPerStudyCount,s=!1;if(n.length!==r.length||i!==a)s=!0;else for(var u=0;u<r.length;u++)if(r[u].series.length!==o[u]){o[u]=r[u].series.length,s=!0;break}s&&this.updateButtonGroups(),t&&this.setState({toolbarButtons:z.call(this)},this.closeCineDialogIfNotApplicable)}},{key:"render",value:function(){var e=this,t=_.call(this,this.state.toolbarButtons,this.state.activeButtons),n=function(t,n){e.props.handleSidePanelChange(t,n)},i=n.bind(this,"left"),a=n.bind(this,"right");return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"ToolbarRow"},r.a.createElement("div",{className:"pull-left m-t-1 p-y-1",style:{padding:"10px"}},r.a.createElement(f.q,{options:this.buttonGroups.left,value:this.props.selectedLeftSidePanel||"",onValueChanged:i})),r.a.createElement(f.C,{label:"New study",icon:"th",isActive:!0,onClick:this.props.handleNewStudy}),t,this.props.studies.length>0&&r.a.createElement(f.C,{label:this.props.maximized?"Minimize":"Maximize",icon:"maximize",isActive:this.props.studies.length>0,onClick:this.props.handleMaximize}),this.props.studies.length>0&&r.a.createElement(f.C,{label:"Upload image",icon:"create-screen-capture",isActive:this.props.studies.length>0,onClick:this.props.handleUpload}),r.a.createElement("div",{className:"pull-right m-t-1 rm-x-1",style:{marginLeft:"auto"}},this.buttonGroups.right.length&&r.a.createElement(f.q,{options:this.buttonGroups.right,value:this.props.selectedRightSidePanel||"",onValueChanged:a}))))}}])&&T(n.prototype,i),a&&T(n,a),t}(a.Component);function N(e,t){var n=e.CustomComponent;if("function"==typeof n){var i=t.map((function(e){return e.id})),a=i.includes(e.id);return r.a.createElement(n,{parentContext:this,toolbarClickCallback:B.bind(this),button:e,key:e.id,activeButtons:i,isActive:a})}}function L(e,t){var n,i=this,a=e.buttons.map((function(e){return e.onClick=B.bind(i,e),t.map((function(e){return e.id})).indexOf(e.id)>-1&&(n=e.id),e}));return r.a.createElement(f.g,{key:e.id,label:e.label,icon:e.icon,buttons:a,activeCommand:n})}function q(e,t){return r.a.createElement(f.C,{key:e.id,label:e.label,icon:e.icon,onClick:B.bind(this,e),isActive:t.map((function(e){return e.id})).includes(e.id)})}function _(e,t){var n=this;return e.map((function(e){var i=e.CustomComponent,a=e.buttons&&e.buttons.length;return i?N.call(n,e,t):a?L.call(n,e,t):q.call(n,e,t)}))}function B(e,t,n){var i=this.state.activeButtons;if(e.commandName){var a=Object.assign({evt:t},e.commandOptions);y.a.runCommand(e.commandName,a)}if("setToolActive"===e.type){var r=i.filter((function(e){var t=e.options;return t&&!t.togglable}));this.setState({activeButtons:[].concat(U(r),[e])})}else"builtIn"===e.type&&this._handleBuiltIn(e)}function z(){var e=this,t=y.c.modules[d.a.TOOLBAR],n=[];return t.forEach((function(t){var i=t.module,a=i.definitions,r=i.defaultContext;a.forEach((function(t){var i=t.context||r;e.props.activeContexts.includes(i)&&n.push(t)}))})),n}function F(e){var t=this.props,n=t.dialog,i=t.t,a=this.state.dialogId,r=e.id,o=e.options;if("CINE"===o.behavior)if(a)n.dismiss({id:a}),this.setState((function(e){return{dialogId:null,activeButtons:U(e.activeButtons.filter((function(e){return e.id!==r})))}}));else{var s=document.querySelector(".ViewerMain").getBoundingClientRect(),u=s.x,c=s.y,l=n.create({content:E,defaultPosition:{x:u+20||0,y:c+20||0}});this.setState((function(t){return{dialogId:l,activeButtons:[].concat(U(t.activeButtons),[e])}}))}"DOWNLOAD_SCREEN_SHOT"===o.behavior&&y.a.runCommand("showDownloadViewportModal",{title:i("Download High Quality Image")})}A(M,"propTypes",{isLeftSidePanelOpen:s.a.bool.isRequired,isRightSidePanelOpen:s.a.bool.isRequired,selectedLeftSidePanel:s.a.string.isRequired,selectedRightSidePanel:s.a.string.isRequired,handleSidePanelChange:s.a.func.isRequired,handleMaximize:s.a.func.isRequired,handleNewStudy:s.a.func.isRequired,handleUpload:s.a.func.isRequired,activeContexts:s.a.arrayOf(s.a.string).isRequired,studies:s.a.array,t:s.a.func.isRequired,dialog:s.a.any,modal:s.a.any,maximized:s.a.bool.isRequired}),A(M,"defaultProps",{studies:[]});var G=Object(h.d)(["Common","ViewportDownloadForm"])(Object(f.M)(Object(f.L)(Object(P.e)(M))));l.a.utils.studyMetadataManager;var W=l.a.redux.actions,H=(W.clearViewportSpecificData,W.setActiveViewportSpecificData,W.setViewportLayoutAndData),J=Object(i.b)((function(e,t){var n=e.loading.progress,i=w()(t.studies);return i.forEach((function(e){e.thumbnails.forEach((function(e){var t=e.displaySetInstanceUID,i="StackProgress:".concat(t),a=n[i],r=0;a&&(r=a.percentComplete),e.stackPercentComplete=r}))})),{studies:i}}),(function(e,t){return{onThumbnailClick:function(n,i){console.log("onThumbnailClick"),console.log(i),console.log(t.studyMetadata);for(var a=[],r=0,o=0;o<t.studyMetadata.length;o++)for(var s=t.studyMetadata[o],u=0;u<s.displaySets.length;u++){var c=s.displaySets[u];c.SeriesInstanceUID===i&&(a.push(c),c.Maximized||r++)}console.log(a);var l=2,p=2;1==r?(l=1,p=1):2==r?(l=1,p=2):3==r?(l=1,p=3):4==r?(l=2,p=2):5==r?(l=2,p=3):6==r?(l=2,p=3):7==r?(l=2,p=4):8==r?(l=2,p=4):9==r?(l=3,p=3):10==r&&(l=3,p=4);var d=[];for(o=0;o<r;o++)d.push({plugin:"cornerstone"});e(H({numRows:l,numColumns:p,viewports:d},a))}}}))(f.w),Y=(n(1044),n(1045),n(133)),Q=n(192);n(1046);function K(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],i=!0,a=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(e){a=!0,r=e}finally{try{i||null==s.return||s.return()}finally{if(a)throw r}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var X=function(e){console.log("ViewportPane");var t=e.children,n=e.onDrop,i=e.onClick,a=e.viewportIndex,o=e.className,s=K(Object(Q.d)({accept:"thumbnail",drop:function(e,t){var i=t.canDrop(),r=t.isOver();if(i&&r&&n){var o=e.StudyInstanceUID,s=e.displaySetInstanceUID;n({viewportIndex:a,StudyInstanceUID:o,displaySetInstanceUID:s})}},collect:function(e){return{highlighted:e.canDrop(),hovered:e.isOver()}}}),2),u=s[0],l=u.hovered,p=u.highlighted,d=s[1];return r.a.createElement("div",{className:c()("viewport-drop-target",{hovered:l},{highlighted:p},o),ref:d,"data-cy":"viewport-container-".concat(a),onClick:function(e){return i(a)}},t)};X.propTypes={children:s.a.node.isRequired,viewportIndex:s.a.number.isRequired,onDrop:s.a.func.isRequired,onClick:s.a.func.isRequired,className:s.a.string};var Z=X;var $=n(1047),ee=n.n($),te=Y.a.loadAndCacheDerivedDisplaySets,ne=function(e){var t=e.activeViewportIndex,n=e.availablePlugins,i=e.defaultPlugin,o=e.layout,s=e.numRows,u=e.numColumns,l=e.setViewportData,p=e.studies,d=e.viewportData,m=e.children,v=e.isStudyLoaded,h=e.maximized,y=e.onSetActiveViewport;console.log("ViewportGrid"),console.log(h);var g=h?1:s,b=h?1:u,S=100/g,w=100/b;if(!d||!d.length)return null;var I=Object(f.K)();Object(a.useEffect)((function(){v&&d.forEach((function(e){console.log("loadAndCacheDerivedDisplaySets"),te(e,p).forEach((function(e){e.catch((function(e){I.show({title:"Error loading derived display set:",message:e.message,type:"error",error:e,autoClose:!1})}))}))}))}),[p,d,v,I]);var D=function(e,a){console.log("In getMaximizedViewportPane"),console.log(d);for(var o=d[a],s=0;s<d.length;s++){var u=d[s];if(u.Maximized){o=u;break}}if(u.frameIndex=a,console.log("In getMaximizedViewportPane, after fetching maximized display set:"),console.log(o),!o)return null;var f={displaySet:o,studies:p},v=!e.plugin&&o&&o.plugin?o.plugin:e.plugin,h=ie(f,a,m,n,v,i);return r.a.createElement(Z,{onDrop:l,onClick:function(){return null},viewportIndex:a,className:c()("viewport-container",{active:t===a}),key:a},h)},E=(console.log("getViewportPanes"),h?[D(o,t)]:o.viewports.map((function(e,a){return function(e,a){var o=d[a];if(console.log("In getViewportPanes viewport loop. Display set:"),console.log(o),!o)return null;var s={displaySet:o,studies:p},u=!e.plugin&&o&&o.plugin?o.plugin:e.plugin,f=ie(s,a,m,n,u,i);return r.a.createElement(Z,{onDrop:l,onClick:y,viewportIndex:a,className:c()("viewport-container",{active:t===a}),key:a},f)}(e,a)})));return r.a.createElement("div",{"data-cy":"viewprt-grid",style:{display:"grid",gridTemplateRows:"repeat(".concat(g,", ").concat(S,"%)"),gridTemplateColumns:"repeat(".concat(b,", ").concat(w,"%)"),height:"100%",width:"100%"}},E)};function ie(e,t,n,i,a,o){if(console.log("_getViewportComponent"),e.displaySet){var s=i[a=a||o];if(!s)throw new Error("No Viewport Component available for name ".concat(a,".\n         Available plugins: ").concat(JSON.stringify(i)));return r.a.createElement(s,{viewportData:e,viewportIndex:t,children:[n]})}return r.a.createElement(ee.a,null)}ne.propTypes={viewportData:s.a.array.isRequired,supportsDrop:s.a.bool.isRequired,activeViewportIndex:s.a.number.isRequired,layout:s.a.object.isRequired,availablePlugins:s.a.object.isRequired,setViewportData:s.a.func.isRequired,studies:s.a.array,children:s.a.node,defaultPlugin:s.a.string,numRows:s.a.number.isRequired,numColumns:s.a.number.isRequired,maximized:s.a.bool.isRequired},ne.defaultProps={viewportData:[],numRows:1,numColumns:1,layout:{viewports:[{}]},activeViewportIndex:0,supportsDrop:!0,availablePlugins:{DefaultViewport:function(e){return React.createElement("div",null,JSON.stringify(e))}},defaultPlugin:"defaultViewportPlugin",maximized:!1};var ae=ne,re=n(633),oe=n.n(re),se=l.b.redux.actions.setViewportActive,ue=oe()((function(e){var t={};return e.forEach((function(e){t[e.extensionId]=e.module})),t})),ce=Object(i.b)((function(e){var t,n=y.c.modules[d.a.VIEWPORT],i=ue(n);n.length&&(t=n[0].extensionId);var a=e.viewports;return{numRows:a.numRows,numColumns:a.numColumns,layout:a.layout,activeViewportIndex:a.activeViewportIndex,availablePlugins:i,defaultPlugin:t}}),(function(e){return{onSetActiveViewport:function(t){e(se(t))}}}))(ae),le=n(1048),pe=n.n(le);function de(e){return(de="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function fe(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function me(e){return(me=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ve(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function he(e,t){return(he=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ye(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ge=oe()(pe.a),be=function(e){function t(e){var n,i,a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i=this,a=me(t).call(this,e),n=!a||"object"!==de(a)&&"function"!=typeof a?ve(i):a,ye(ve(n),"fillEmptyViewportPanes",(function(){var e=[],t=n.props,i=t.layout,a=t.viewportSpecificData,r=n.state.displaySets;if(r&&r.length){for(var o=0;o<i.viewports.length;o++){var s=a[o];if(s&&s.StudyInstanceUID&&s.displaySetInstanceUID)e.push({StudyInstanceUID:s.StudyInstanceUID,displaySetInstanceUID:s.displaySetInstanceUID});else{var u=r.find((function(t){return!e.some((function(e){return e.displaySetInstanceUID===t.displaySetInstanceUID}))}))||r[r.length-1];e.push(u)}}e.forEach((function(e,t){e&&e.StudyInstanceUID&&n.setViewportData({viewportIndex:t,StudyInstanceUID:e.StudyInstanceUID,displaySetInstanceUID:e.displaySetInstanceUID})}))}})),ye(ve(n),"setViewportData",(function(e){var t=e.viewportIndex,i=e.StudyInstanceUID,a=e.displaySetInstanceUID,r=n.findDisplaySet(n.props.studies,i,a);if(r){if(r.isDerived){var o=r.Modality;if(!(r=r.getSourceDisplaySet(n.props.studies)))throw new Error("Referenced series for ".concat(o," dataset not present."))}n.props.setViewportSpecificData(t,r)}})),n.state={displaySets:[]},n}var n,i,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&he(e,t)}(t,e),n=t,(i=[{key:"getDisplaySets",value:function(e){if(!e||0==e.length)return[];var t=e[0];if(!t.displaySets||0==t.displaySets.length)return[];var n=t.displaySets[0].SeriesNumber,i=[];return t.displaySets.forEach((function(e){e.SeriesNumber===n&&(e.plugin||(e.plugin="cornerstone"),i.push(e))})),i}},{key:"findDisplaySet",value:function(e,t,n){var i=e.find((function(e){return e.StudyInstanceUID===t}));if(i)return i.displaySets.find((function(e){return e.displaySetInstanceUID===n}))}},{key:"componentDidMount",value:function(){if(this.props.studies){var e=this.getDisplaySets(this.props.studies);this.setState({displaySets:e},this.fillEmptyViewportPanes)}}},{key:"componentDidUpdate",value:function(e){var t=e.layout.viewports.length,n=this.props.layout.viewports.length,i=this.props.layout.viewports.some((function(e){return!!e.vtk}));if(this.props.studies!==e.studies||n!==t&&!i){var a=this.getDisplaySets(this.props.studies);this.setState({displaySets:a},this.fillEmptyViewportPanes)}}},{key:"render",value:function(){var e=this.props.viewportSpecificData,t=ge(e);return r.a.createElement("div",{className:"ViewerMain"},this.state.displaySets.length&&r.a.createElement(ce,{isStudyLoaded:this.props.isStudyLoaded,studies:this.props.studies,viewportData:t,setViewportData:this.setViewportData,maximized:this.props.maximized}))}},{key:"componentWillUnmount",value:function(){var e=this,t=this.props.viewportSpecificData;Object.keys(t).forEach((function(t){e.props.clearViewportSpecificData(t)}))}}])&&fe(n.prototype,i),a&&fe(n,a),t}(a.Component);ye(be,"propTypes",{activeViewportIndex:s.a.number.isRequired,studies:s.a.array,viewportSpecificData:s.a.object.isRequired,layout:s.a.object.isRequired,setViewportSpecificData:s.a.func.isRequired,clearViewportSpecificData:s.a.func.isRequired,maximized:s.a.bool.isRequired});var Se=be,we=l.b.redux.actions,Ie=we.setViewportSpecificData,De=we.clearViewportSpecificData,Ee=Object(i.b)((function(e){var t=e.viewports,n=t.activeViewportIndex,i=t.layout,a=t.viewportSpecificData,r=t.maximized;return{activeViewportIndex:n,layout:i,viewportSpecificData:a,viewports:e.viewports,maximized:r}}),(function(e){return{setViewportSpecificData:function(t,n){e(Ie(t,n))},clearViewportSpecificData:function(){e(De())}}}))(Se),Oe=(n(1050),function(e){var t=e.from,n=e.isOpen,i=e.children,a=e.width,o="right"===t?"from-right":"from-left",s=a?{maxWidth:a,marginRight:n?"0":-1*Number.parseInt(a)}:{};return r.a.createElement("section",{style:s,className:c()("sidepanel",o,{"is-open":n})},i)});Oe.propTypes={from:s.a.string.isRequired,isOpen:s.a.bool.isRequired,children:s.a.node,width:s.a.string};var Ce=Oe;n(1051);function xe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],i=!0,a=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(e){a=!0,r=e}finally{try{i||null==s.return||s.return()}finally{if(a)throw r}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var Pe=y.d.services.UIModalService,Ue=function(e){var t=e.context,n=e.children;return r.a.createElement(f.e,{fallbackComponent:function(){return r.a.createElement("div",{className:"ErrorFallback",role:"alert"},r.a.createElement("p",null,"Error rendering ",t,". ",r.a.createElement("br",null)," Check the browser console for more details."))},context:t,onError:function(e,n){Pe.show({content:function(){var i=xe(Object(a.useState)(!1),2),o=i[0],s=i[1];return r.a.createElement("div",{className:"ErrorFallback",role:"alert"},r.a.createElement("div",{className:"ErrorBoundaryDialog"},r.a.createElement("h3",{className:"ErrorBoundaryDialogTitle"},t,": ",r.a.createElement("span",null,e.message))),r.a.createElement("button",{className:"btn btn-primary btn-sm ErrorBoundaryDialogButton",onClick:function(){return s((function(e){return!e}))}},r.a.createElement(f.h,{name:"chevron-down",className:c()("ErrorBoundaryDialogIcon",{opened:o})}),"Stack Trace"),o&&r.a.createElement("pre",null,n))},title:"Something went wrong in ".concat(t)})}},n)};Ue.propTypes={context:s.a.string.isRequired,children:s.a.node.isRequired};var Ve=Ue,Te=n(492);n(1052);function Re(e){return(Re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ke(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function je(e){return(je=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ae(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Me(e,t){return(Me=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ne(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Le=function(e){function t(e){var n,i,a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i=this,a=je(t).call(this,e),n=!a||"object"!==Re(a)&&"function"!=typeof a?Ae(i):a,Ne(Ae(n),"onClose",(function(){n.props.onCancel()})),Ne(Ae(n),"onConfirm",(function(e){e.preventDefault();var t=n.state.pick<0?null:n.state.layouts[n.state.pick];n.props.onConfirm(t)})),n.state={layouts:["Panoramic","Four Bitewings"],pick:-1},n}var n,i,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Me(e,t)}(t,e),n=t,(i=[{key:"render",value:function(){var e=this;return r.a.createElement(Te.a,{headerTitle:"Pick Layout",onClose:this.onClose,onConfirm:this.onConfirm,rootClass:"LayoutPickerDialog"},r.a.createElement(f.y,{headless:!0},this.state.layouts.map((function(t,n){return r.a.createElement(f.z,{itemClass:n==e.state.pick?"SelectedLayoutPickerItem":"LayoutPickerItem",itemMetaClass:"LayoutPickerItemMeta",onItemClick:function(){return e.setState({pick:n})}},t)}))))}}])&&ke(n.prototype,i),a&&ke(n,a),t}(a.Component);Ne(Le,"propTypes",{onCancel:s.a.func.isRequired,onConfirm:s.a.func.isRequired});var qe=Le,_e=n(48),Be=n(35);n(234),n(255),n(1053),n(1054);function ze(e){return(ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Fe(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Ge(e){return(Ge=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function We(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function He(e,t){return(He=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Je(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ye=Be.a.data,Qe=Ye.DicomMetaDictionary,Ke=Ye.DicomDict,Xe=Y.a.guid,Ze=function(e){function t(e){var n,i,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i=this,a=Ge(t).call(this,e),n=!a||"object"!==ze(a)&&"function"!=typeof a?We(i):a,Je(We(n),"state",{isLeftSidePanelOpen:!0,isRightSidePanelOpen:!1,isSelectingLayout:!1,selectedRightSidePanel:"",selectedLeftSidePanel:"studies",thumbnails:[]}),Je(We(n),"retrieveTimepoints",(function(e){l.b.log.info("retrieveTimepoints");var t=(new Date).toISOString(),i=(new Date).toISOString();return n.props.studies&&(i=new Date("1000-01-01").toISOString(),n.props.studies.forEach((function(e){var n=v()(e.StudyDate,"YYYYMMDD").toISOString();n<t&&(t=n),n>i&&(i=n)}))),Promise.resolve([{timepointType:"baseline",timepointId:"TimepointId",studyInstanceUIDs:n.props.studyInstanceUIDs,PatientID:e.PatientID,earliestDate:t,latestDate:i,isLocked:!1}])})),Je(We(n),"storeTimepoints",(function(e){return l.b.log.info("storeTimepoints"),Promise.resolve()})),Je(We(n),"updateTimepoint",(function(e,t){return l.b.log.info("updateTimepoint"),Promise.resolve()})),Je(We(n),"removeTimepoint",(function(e){return l.b.log.info("removeTimepoint"),Promise.resolve()})),Je(We(n),"disassociateStudy",(function(e,t){return l.b.log.info("disassociateStudy"),Promise.resolve()})),Je(We(n),"onTimepointsUpdated",(function(e){n.props.onTimepointsUpdated&&n.props.onTimepointsUpdated(e)})),Je(We(n),"onMeasurementsUpdated",(function(e){n.props.onMeasurementsUpdated&&n.props.onMeasurementsUpdated(e)}));var r=n.props.activeServer,o=Object.assign({},r);return l.b.measurements.MeasurementApi.setConfiguration({dataExchange:{retrieve:p.a.retrieveMeasurements,store:p.a.storeMeasurements},server:o}),l.b.measurements.TimepointApi.setConfiguration({dataExchange:{retrieve:n.retrieveTimepoints,store:n.storeTimepoints,remove:n.removeTimepoint,update:n.updateTimepoint,disassociate:n.disassociateStudy}}),n._getActiveViewport=n._getActiveViewport.bind(We(n)),n}var n,i,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&He(e,t)}(t,e),n=t,(i=[{key:"componentWillUnmount",value:function(){this.props.dialog&&this.props.dialog.dismissAll()}},{key:"componentDidMount",value:function(){var e=this.props,t=e.studies,n=e.isStudyLoaded,i=l.b.measurements,a=i.TimepointApi,r=i.MeasurementApi,o=new a("TimepointId",{onTimepointsUpdated:this.onTimepointsUpdated}),s=new r(o,{onMeasurementsUpdated:this.onMeasurementsUpdated});if(this.currentTimepointId="TimepointId",this.timepointApi=o,this.measurementApi=s,t){var u=t[0]&&t[0].PatientID;o.retrieveTimepoints({PatientID:u}),n&&this.measurementApi.retrieveMeasurements(u,["TimepointId"]),this.setState({thumbnails:et(t)})}}},{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.studies,i=t.isStudyLoaded;if(n!==e.studies&&this.setState({thumbnails:et(n)}),i&&i!==e.isStudyLoaded){var a=n[0]&&n[0].PatientID,r=this.currentTimepointId;this.timepointApi.retrieveTimepoints({PatientID:a}),this.measurementApi.retrieveMeasurements(a,[r])}}},{key:"_getActiveViewport",value:function(){return this.props.viewports[this.props.activeViewportIndex]}},{key:"getClient",value:function(e){var t=window.access_token;console.log("token:"),console.log(t);var n={Authorization:"Bearer "+t};return new _e.a.DICOMwebClient({url:e,headers:n})}},{key:"createNewStudy",value:function(e){console.log("createNewStudy");var t=new Uint8Array(2);t[1]=1;var n={"00020001":{Value:[t.buffer],vr:"OB"},"00020012":{Value:["1.2.840.113819.7.1.1997.1.0"],vr:"UI"},"00020002":{Value:["1.2.840.10008.5.1.4.1.1.131"],vr:"UI"},"00020003":{Value:[Qe.uid()],vr:"UI"},"00020010":{Value:["1.2.840.10008.1.2"],vr:"UI"}},i=(e={StudyInstanceUID:Xe(),SeriesInstanceUID:Xe(),SOPInstanceUID:Xe(),SOPClassUID:"1.2.840.10008.5.1.4.1.1.131",ImageBoxes:[{"00720302":{vr:"US",Value:[0]}},{"00720302":{vr:"US",Value:[1]}},{"00720302":{vr:"US",Value:[2]}}]},new Ke(n));i.upsertTag("0020000D","UI",[e.StudyInstanceUID]),i.upsertTag("0020000E","UI",[e.SeriesInstanceUID]),i.upsertTag("00200013","IS",["0"]),i.upsertTag("00080018","UI",[e.SOPInstanceUID]),i.upsertTag("00080016","UI",[e.SOPClassUID]),i.upsertTag("00720422","SQ",e.ImageBoxes),i.upsertTag("00100020","LO",[this.props.patientID]);var a=i.write();console.log("buffer:"),console.log(a);var r=this.props.activeServer.wadoRoot;console.log(r);var o=this.getClient(r),s=this.props;o.storeInstances({datasets:[a]}).then((function(t){s.onNewStudy(e)}))}},{key:"uploadImage",value:function(){var e=this.props.activeViewportIndex,t=this;this.loadImage((function(n){t.createNewImageInstance(e,n)}))}},{key:"loadImage",value:function(e){var t=document.createElement("input");t.setAttribute("type","file"),t.setAttribute("accept","image/*"),t.onchange=function(t){var n=t.target.files[0],i=new FileReader;i.onerror=function(e){console.log("reader error"),console.log(e)},i.onload=function(t){var n=document.createElement("img");n.src=t.target.result,n.decode().then((function(){console.log("image onload"),console.log(n.naturalWidth),console.log(n.naturalHeight);var t=document.createElement("canvas");t.width=n.naturalWidth,t.height=n.naturalHeight;var i=t.getContext("2d");i.drawImage(n,0,0);var a=i.getImageData(0,0,t.width,t.height);console.log("image data"),console.log(a),e(a)})).catch((function(e){console.log(e)}))},i.readAsDataURL(n)},document.body.appendChild(t),t.click(),document.body.removeChild(t)}},{key:"createNewImageInstance",value:function(e,t){var n=this.props.viewports[e],i=new Uint8Array(2);i[1]=1;var a={"00020001":{Value:[i.buffer],vr:"OB"},"00020012":{Value:["1.2.840.113819.7.1.1997.1.0"],vr:"UI"},"00020002":{Value:["1.2.840.10008.5.1.4.1.1.1.1"],vr:"UI"},"00020003":{Value:[Qe.uid()],vr:"UI"},"00020010":{Value:["1.2.840.10008.1.2"],vr:"UI"}},r=new Ke(a);r.upsertTag("00100020","LO",[this.props.patientID]),r.upsertTag("0020000D","UI",[n.StudyInstanceUID]),r.upsertTag("0020000E","UI",[n.SeriesInstanceUID]),r.upsertTag("00200013","IS",[e.toString()]),r.upsertTag("00080018","UI",[Xe()]),r.upsertTag("00080016","UI",["1.2.840.10008.5.1.4.1.1.1.1"]),r.upsertTag("00280006","US",[0]),r.upsertTag("00280004","CS",["RGB"]),r.upsertTag("00280002","US",[3]),r.upsertTag("00280010","US",[t.height]),r.upsertTag("00280011","US",[t.width]),r.upsertTag("00280100","US",[8]),r.upsertTag("00280101","US",[8]),r.upsertTag("00280102","US",[7]),r.upsertTag("00280103","US",[0]);var o=new Uint8Array(t.data.buffer);r.upsertTag("7FE00010","OB",[o]);var s=r.write(),u=this.props.activeServer.wadoRoot,c=this.getClient(u);this.props,c.storeInstances({datasets:[s]}).then((function(e){console.log("result:"),console.log(e)}))}},{key:"render",value:function(){var e,t,n=this;return y.c.modules[d.a.PANEL].forEach((function(i){i.module.components.forEach((function(i){i.id===n.state.selectedRightSidePanel?t=i.component:i.id===n.state.selectedLeftSidePanel&&(e=i.component)}))})),console.log("Viewer render()"),console.log(this.props.viewports),console.log(this.props.activeViewportIndex),console.log(this.props.studies),r.a.createElement(r.a.Fragment,null,this.state.isSelectingLayout&&r.a.createElement(qe,{onCancel:function(){n.setState({isSelectingLayout:!1})},onConfirm:function(e){n.setState({isSelectingLayout:!1}),n.createNewStudy(e)}}),r.a.createElement(Ve,{context:"ToolbarRow"},r.a.createElement(G,{activeViewport:this.props.viewports[this.props.activeViewportIndex],isLeftSidePanelOpen:this.state.isLeftSidePanelOpen,isRightSidePanelOpen:this.state.isRightSidePanelOpen,selectedLeftSidePanel:this.state.isLeftSidePanelOpen?this.state.selectedLeftSidePanel:"",selectedRightSidePanel:this.state.isRightSidePanelOpen?this.state.selectedRightSidePanel:"",handleSidePanelChange:function(e,t){var i=e&&e[0].toUpperCase()+e.slice(1),a="is".concat(i,"SidePanelOpen"),r="selected".concat(i,"SidePanel"),o=Object.assign({},n.state),s=o[a],u=o[r],c=u===t||null===t;o[r]=t||u,(!s||c)&&(o[a]=!o[a]),n.setState(o)},handleMaximize:this.props.onMaximize,handleNewStudy:function(){n.setState({isSelectingLayout:!0})},handleUpload:this.uploadImage.bind(this),studies:this.props.studies,maximized:this.props.maximized})),r.a.createElement("div",{className:"FlexboxLayout"},r.a.createElement(Ve,{context:"LeftSidePanel"},r.a.createElement(Ce,{from:"left",isOpen:this.state.isLeftSidePanelOpen},e?r.a.createElement(e,{viewports:this.props.viewports,studies:this.props.studies,activeIndex:this.props.activeViewportIndex}):r.a.createElement("div",null,r.a.createElement(J,{studies:this.state.thumbnails,studyMetadata:this.props.studies})))),r.a.createElement("div",{className:c()("main-content")},this.state.isSelectingLayout?r.a.createElement("p",null,"Please select layout..."):r.a.createElement(Ve,{context:"ViewerMain"},r.a.createElement(Ee,{studies:this.props.studies,isStudyLoaded:this.props.isStudyLoaded}))),r.a.createElement(Ve,{context:"RightSidePanel"},r.a.createElement(Ce,{from:"right",isOpen:this.state.isRightSidePanelOpen},t&&r.a.createElement(t,{isOpen:this.state.isRightSidePanelOpen,viewports:this.props.viewports,studies:this.props.studies,activeIndex:this.props.activeViewportIndex,activeViewport:this.props.viewports[this.props.activeViewportIndex],getActiveViewport:this._getActiveViewport})))))}}])&&Fe(n.prototype,i),a&&Fe(n,a),t}(a.Component);Je(Ze,"propTypes",{studies:s.a.arrayOf(s.a.shape({StudyInstanceUID:s.a.string.isRequired,StudyDate:s.a.string,PatientID:s.a.string,series:s.a.arrayOf(s.a.shape({SeriesInstanceUID:s.a.string.isRequired})),displaySets:s.a.arrayOf(s.a.shape({displaySetInstanceUID:s.a.string.isRequired,SeriesInstanceUID:s.a.string.isRequired,SeriesDescription:s.a.string,SeriesNumber:s.a.number,InstanceNumber:s.a.number,numImageFrames:s.a.number,Modality:s.a.string.isRequired,images:s.a.arrayOf(s.a.shape({getImageId:s.a.func.isRequired}))}))})),studyInstanceUIDs:s.a.array,activeServer:s.a.shape({type:s.a.string,wadoRoot:s.a.string}),onTimepointsUpdated:s.a.func,onMeasurementsUpdated:s.a.func,onMaximize:s.a.func,onNewStudy:s.a.func,viewports:s.a.object.isRequired,activeViewportIndex:s.a.number.isRequired,isStudyLoaded:s.a.bool,dialog:s.a.object,maximized:s.a.bool.isRequired,patientID:s.a.string});var $e=Object(f.L)(Ze),et=function(e){return e.map((function(e){return console.log("_mapStudiesToThumbnails"),console.log(e),{StudyInstanceUID:e.StudyInstanceUID,thumbnails:e.series.map((function(t){for(var n=void 0,i=1,a=0;a<e.displaySets.length;a++){var r=e.displaySets[a];r.SeriesInstanceUID===t.SeriesInstanceUID&&(n||(n=r),r.Maximized&&(i=r.numImageFrames))}if(!n)return null;var o,s,u=n,c=u.displaySetInstanceUID,l=u.SeriesDescription,p=u.InstanceNumber,d=u.SeriesInstanceUID,f=u.SeriesNumber;if(n.Modality&&"SEG"===n.Modality)s="SEG";else if(n.images&&n.images.length){var m=Math.floor(n.images.length/2);o=n.images[m].getImageId()}else s=n.Modality?n.Modality:"";return{imageId:o,altImageText:s,displaySetInstanceUID:c,SeriesDescription:l,InstanceNumber:p,numImageFrames:i,SeriesInstanceUID:d,SeriesNumber:f}})).filter((function(e){return e}))}}))},tt=l.b.redux.actions,nt=tt.setTimepoints,it=tt.setMeasurements,at=tt.maximize,rt=tt.setStudyData,ot=function(e){return e.servers.find((function(e){return!0===e.active}))},st=Object(i.b)((function(e){var t=e.viewports,n=e.servers;return{viewports:t.viewportSpecificData,activeViewportIndex:t.activeViewportIndex,activeServer:ot(n),maximized:t.maximized}}),(function(e){return{onTimepointsUpdated:function(t){e(nt(t))},onMeasurementsUpdated:function(t){e(it(t))},onMaximize:function(){e(at())},onNewStudy:function(t){e(rt(t.StudyInstanceUID,t))}}}))($e);t.a=st},1043:function(e,t,n){},1044:function(e,t,n){},1045:function(e,t,n){},1046:function(e,t,n){},1047:function(e,t){},1050:function(e,t,n){},1051:function(e,t,n){},1052:function(e,t,n){},1053:function(e,t,n){},1057:function(e,t){},1059:function(e,t){}}]);
//# sourceMappingURL=ConnectedStandaloneRouting~DentalViewerRouting~IHEInvokeImageDisplay~ViewerLocalFileData~ViewerRouting.bundle.b0f9f298a0ba5bf38900.js.map