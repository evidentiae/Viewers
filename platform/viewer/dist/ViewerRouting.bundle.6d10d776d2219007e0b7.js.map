{"version":3,"sources":["webpack:///./routes/ViewerRouting.js"],"names":["UrlUtil","utils","urlUtil","setStudyData","OHIF","redux","actions","getSeriesInstanceUIDs","seriesInstanceUIDs","routeLocation","queryFilters","queryString","getQueryFilters","querySeriesUIDs","_seriesInstanceUIDs","paramString","parseParam","ViewerRouting","routeMatch","match","location","params","token","project","dataset","dicomStore","patientID","studyInstanceUIDs","console","log","user","getAccessToken","window","access_token","server","useServer","studyUIDs","seriesUIDs","dispatch","useDispatch","useEffect","forEach","uid","propTypes","PropTypes","shape","string","isRequired","any"],"mappings":"2FAAA,0GASiBA,EAAYC,IAArBC,QACAC,EAAiBC,IAAKC,MAAMC,QAA5BH,aAOFI,EAAwB,SAACC,EAAoBC,GACjD,IAAMC,EAAeV,EAAQW,YAAYC,gBAAgBH,GACnDI,EAAkBH,GAAgBA,EAAY,kBAC9CI,EAAsBN,GAAsBK,EAElD,OAAOb,EAAQe,YAAYC,WAAWF,IAGxC,SAASG,EAAT,GAAuE,IAAvCC,EAAuC,EAA9CC,MAA6BV,EAAiB,EAA3BW,SAA2B,EAUjEF,EAAWG,OARbC,EAFmE,EAEnEA,MACAC,EAHmE,EAGnEA,QACAH,EAJmE,EAInEA,SACAI,EALmE,EAKnEA,QACAC,EANmE,EAMnEA,WACAC,EAPmE,EAOnEA,UACAC,EARmE,EAQnEA,kBACAnB,EATmE,EASnEA,mBAgBEc,IACFM,QAAQC,IAAI,iBACZD,QAAQC,IAAIP,GACZQ,IAAKC,eAAiB,kBAAMT,GAC5BU,OAAOC,aAAeX,GAGxB,IAAMY,EAASC,YAAU,CAAEZ,UAASH,WAAUI,UAASC,eAEjDW,EAAYT,EAAoB3B,EAAQe,YAAYC,WAAWW,GAAqB,GACpFU,EAAa7B,EAAqBD,EAAsBC,EAAoBC,GAAiB,GAEnGmB,QAAQC,IAAI,cACZD,QAAQC,IAAIO,GAEZ,IAAME,EAAWC,cAUjB,OARAC,qBAAU,WACRZ,QAAQC,IAAI,QACZO,EAAUK,SAAQ,SAAAC,GAChBd,QAAQC,IAAIa,GACZJ,EAASnC,EAAauC,EAAK,WAI3BR,GAAUE,EAGV,kBAAC,IAAD,CACE5B,mBAAoB6B,EACpBX,UAAWA,IAKV,KAGTT,EAAc0B,UAAY,CACxBxB,MAAOyB,IAAUC,MAAM,CACrBxB,OAAQuB,IAAUC,MAAM,CACtBlB,kBAAmBiB,IAAUE,OAAOC,WACpCvC,mBAAoBoC,IAAUE,OAC9BtB,QAASoB,IAAUE,OACnBrB,WAAYmB,IAAUE,OACtB1B,SAAUwB,IAAUE,OACpBvB,QAASqB,IAAUE,WAGvB1B,SAAUwB,IAAUI,KAGP/B","file":"ViewerRouting.bundle.6d10d776d2219007e0b7.js","sourcesContent":["import React, { useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport { OHIF, utils, user } from '@ohif/core';\n//\nimport ConnectedViewerRetrieveStudyData from '../connectedComponents/ConnectedViewerRetrieveStudyData';\nimport useServer from '../customHooks/useServer';\nimport useQuery from '../customHooks/useQuery';\nimport { useDispatch } from 'react-redux';\n\nconst { urlUtil: UrlUtil } = utils;\nconst { setStudyData } = OHIF.redux.actions;\n\n/**\n * Get array of seriesUIDs from param or from queryString\n * @param {*} seriesInstanceUIDs\n * @param {*} location\n */\nconst getSeriesInstanceUIDs = (seriesInstanceUIDs, routeLocation) => {\n  const queryFilters = UrlUtil.queryString.getQueryFilters(routeLocation);\n  const querySeriesUIDs = queryFilters && queryFilters['seriesInstanceUID'];\n  const _seriesInstanceUIDs = seriesInstanceUIDs || querySeriesUIDs;\n\n  return UrlUtil.paramString.parseParam(_seriesInstanceUIDs);\n};\n\nfunction ViewerRouting({ match: routeMatch, location: routeLocation }) {\n  const {\n    token,\n    project,\n    location,\n    dataset,\n    dicomStore,\n    patientID,\n    studyInstanceUIDs,\n    seriesInstanceUIDs,\n  } = routeMatch.params;\n\n  /*\n  // Waern: token in query parameters seems to end up in studyInstanceUIDs.\n  // So instead of using the below code snippet, we add token as a path component.\n  //\n  // Set the user's default authToken for outbound DICOMWeb requests.\n  // Is only applied if target server does not set `requestOptions` property.\n  //\n  // See: `getAuthorizationHeaders.js`\n  let query = useQuery();\n  const authToken = query.get('token');\n  console.log(authToken);\n  */\n\n  if (token) {\n    console.log(\"setting token\");\n    console.log(token);\n    user.getAccessToken = () => token;\n    window.access_token = token;\n  }\n\n  const server = useServer({ project, location, dataset, dicomStore });\n\n  const studyUIDs = studyInstanceUIDs ? UrlUtil.paramString.parseParam(studyInstanceUIDs) : [];\n  const seriesUIDs = seriesInstanceUIDs ? getSeriesInstanceUIDs(seriesInstanceUIDs, routeLocation) : [];\n\n  console.log(\"studyUIDs:\");\n  console.log(studyUIDs);\n\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    console.log(\"test\");\n    studyUIDs.forEach(uid => {\n      console.log(uid);\n      dispatch(setStudyData(uid, {}));\n    });\n  });\n\n  if (server && studyUIDs) {\n    //studyInstanceUIDs={studyUIDs}\n    return (\n      <ConnectedViewerRetrieveStudyData\n        seriesInstanceUIDs={seriesUIDs}\n        patientID={patientID}\n      />\n    );\n  }\n\n  return null;\n}\n\nViewerRouting.propTypes = {\n  match: PropTypes.shape({\n    params: PropTypes.shape({\n      studyInstanceUIDs: PropTypes.string.isRequired,\n      seriesInstanceUIDs: PropTypes.string,\n      dataset: PropTypes.string,\n      dicomStore: PropTypes.string,\n      location: PropTypes.string,\n      project: PropTypes.string,\n    }),\n  }),\n  location: PropTypes.any,\n};\n\nexport default ViewerRouting;\n"],"sourceRoot":""}