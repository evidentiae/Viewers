{"version":3,"sources":["webpack:///./googleCloud/api/GoogleCloudApi.js","webpack:///./customHooks/usePrevious.js","webpack:///./googleCloud/utils/getServers.js","webpack:///./customHooks/useServer.js","webpack:///./lib/localFileLoaders/fileLoader.js","webpack:///./lib/localFileLoaders/pdfFileLoader.js","webpack:///./lib/localFileLoaders/dicomFileLoader.js","webpack:///./lib/localFileLoaders/fileLoaderService.js","webpack:///./lib/filesToStudies.js","webpack:///./googleCloud/utils/helpers.js","webpack:///./googleCloud/utils/CancellationToken.js","webpack:///./googleCloud/api/DicomUploadService.js","webpack:///./googleCloud/DicomUploader.js","webpack:///./googleCloud/DicomFileUploaderModal.js","webpack:///./googleCloud/ConnectedDicomFilesUploader.js","webpack:///./googleCloud/DicomStoreList.js","webpack:///./googleCloud/DicomStorePicker.js","webpack:///./googleCloud/DatasetsList.js","webpack:///./googleCloud/DatasetPicker.js","webpack:///./googleCloud/ProjectsList.js","webpack:///./googleCloud/ProjectPicker.js","webpack:///./googleCloud/LocationsList.js","webpack:///./googleCloud/LocationPicker.js","webpack:///./googleCloud/DatasetSelector.js","webpack:///./googleCloud/DicomStorePickerModal.js","webpack:///./googleCloud/ConnectedDicomStorePicker.js","webpack:///./studylist/StudyListRoute.js","webpack:///./studylist/ConnectedStudyList.js","webpack:///./studylist/StudyListRouting.js"],"names":["GoogleCloudApi","accessToken","console","error","this","project","location","dataset","dicomStore","urlBase","urlStr","config","params","url","URL","data","search","URLSearchParams","fetch","fetchConfig","response","json","status","nextPageToken","pageToken","doRequest","key","subPage","hasOwnProperty","concat","isError","message","projectId","urlBaseProject","locationId","access_token","window","Error","method","headers","Authorization","healthcareApiEndpoint","usePrevious","value","ref","useRef","useEffect","current","getServers","name","wadoUriRoot","qidoRoot","wadoRoot","imageRendering","thumbnailRendering","type","active","supportsFuzzyMatching","qidoSupportsIncludeField","isValidServer","server","isEqualServer","toCompare","serverLength","Object","keys","length","toCompareLength","getActiveServer","servers","find","a","appConfig","enableGoogleCloudAdapter","pathUrl","getUrlBaseDicomWeb","GoogleCloudUtilServers","setServers","dispatch","useServerFromUrl","previousServers","activeServer","urlBasedServers","serverHasChanged","newServer","exists","some","bind","undefined","useServer","useSelector","state","useDispatch","useContext","AppContext","FileLoader","file","imageId","image","PDFFileLoader","cornerstoneWADOImageLoader","wadouri","loadFileRequest","getDefaultStudy","StudyInstanceUID","StudyDate","StudyTime","AccessionNumber","ReferringPhysicianName","PatientName","PatientID","PatientBirthdate","PatientSex","StudyId","StudyDescription","series","SeriesInstanceUID","SeriesDescription","SeriesNumber","instances","metadata","SOPInstanceUID","SOPClassUID","Rows","Columns","NumberOfFrames","InstanceNumber","getImageId","isLocalFile","metadataProvider","OHIF","cornerstone","DICOMFileLoader","dicomData","dcmjs","DicomMessage","readFile","DicomMetaDictionary","naturalizeDataset","dict","addInstance","_meta","namifyDataset","meta","e","getStudyFromDataset","PatientBirthDate","StudyID","instance","study","FileLoaderService","fileType","loader","getLoader","studies","groupBy","list","groupByKey","listKey","nonKeyCounter","reduce","acc","obj","push","values","map","studyGroup","seriesGrouped","fileManager","add","loadFile","getDataset","getStudies","processFile","fileLoaderService","addFile","log","filesToStudies","files","processFilesPromises","Promise","all","groupSeries","flat","formatFileSize","size","n","Math","floor","pow","toFixed","httpErrorToStr","jsonResponse","JSON","parse","code","err","checkDicomFile","arrayBuffer","arr","Uint8Array","slice","Array","from","every","char","i","charCodeAt","CancellationToken","cancelled","uploadCallback","cancellationToken","CHUNK_SIZE","MAX_PARALLEL_JOBS","filesArray","parallelJobsCount","min","completed","processJob","resolve","reject","get","chunk","simpleUpload","forEach","fileId","client","getClient","loadedFile","content","storeInstances","datasets","reader","FileReader","onload","result","onerror","readAsArrayBuffer","func","retrieveAuthHeaderFunc","errorHandler","getHTTPErrorHandler","api","DICOMwebClient","DicomUploader","isCancelled","errorsCount","uploadedVolume","wholeVolumeStr","isFilesListHidden","timeLeft","uploadedList","totalCount","successfullyUploadedCount","lastFile","uploadContext","target","filesDict","fileDesc","id","path","webkitRelativePath","processed","processedInUI","wholeVolume","f","b","random","setState","dicomUploader","setRetrieveAuthHeaderFunction","props","retrieveAuthHeaderFunction","smartUpload","call","style","color","className","parseInt","errors","htmlFor","src","alt","onChange","uploadFiles","multiple","webkitdirectory","mozdirectory","percents","filesLeft","renderTableRow","Component","PropTypes","string","event","DicomFileUploaderModal","isOpen","onClose","t","UIModalService","servicesManager","services","Fragment","show","title","contentProps","propTypes","bool","isRequired","withTranslation","isActive","ConnectedDicomFileUploader","connect","DICOMWeb","getAuthorizationHeader","DicomStoreList","store","highlightedItem","onMouseEnter","onHighlightItem","onClick","onSelect","split","loading","stores","filter","loadingIcon","body","toLowerCase","includes","array","DicomStorePicker","locations","filterStr","setAccessToken","loadDicomStores","dicomStores","object","DatasetsList","DatasetPicker","loadDatasets","ProjectsList","projects","lowerCaseFilter","filteredProjects","ProjectPicker","LocationsList","LocationPicker","loadLocations","DatasetSelector","unloading","dicomStoreJson","parts","user","onProjectClick","onLocationClick","onDatasetClick","onProjectSelect","onLocationSelect","onDatasetSelect","onDicomStoreSelect","projectBreadcrumbs","canClose","DicomStorePickerModal","dicomstore","hide","ConnectedDicomStorePicker","oidc","UrlUtil","utils","urlUtil","StudyListRoute","history","studyListFunctionsEnabled","useTranslation","useState","fieldName","direction","sort","setSort","studyDateTo","studyDateFrom","modalities","patientNameOrId","accessionOrModalityOrDescription","allFields","filterValues","setFilterValues","setStudies","isSearchingForStudies","searchStatus","setSearchStatus","activeModalId","setActiveModalId","rowsPerPage","setRowsPerPage","pageNumber","setPageNumber","appContext","displaySize","useMedia","debouncedSort","useDebounce","debouncedFilters","getStudyList","warn","isFetching","fetchStudies","stringify","healthCareApiButtons","healthCareApiWindows","isModalOpen","listPath","RoutesUtil","paramString","isValidPath","pathname","replace","updateURL","padding","ConnectedDicomFilesUploader","WhiteLabelingContext","Consumer","whiteLabeling","UserManagerContext","userManager","ConnectedHeader","useLargeLogo","createLogoComponentFn","React","fontWeight","fontSize","onImport","isLoading","hasError","onSelectItem","studyInstanceUID","viewerPath","studyInstanceUIDs","onSort","sortFieldName","sortDirection","onFilterChange","studyListDateFilterNumDays","currentPage","nextPageFunc","prevPageFunc","onRowsPerPageChange","recordCount","filters","moment","subtract","toDate","Date","mappedFilters","ModalitiesInStudy","limit","offset","fuzzymatching","_fetchStudies","mappedStudies","sortedStudies","_sortStudies","numToTake","field","order","isValid","format","fieldA","fieldB","toISOString","queryFiltersArray","firstSet","_getQueryFiltersForValue","secondSet","queryPromises","searchStudiesPromise","searchStudies","lotsOfStudies","arrayOfStudies","s","fields","queryFilters","assign","defaultProps","withRouter","ConnectedStudyList","StudyListRouting","routeMatch","match","routeLocation","seriesInstanceUIDs","queryString","getQueryFilters","shape"],"mappings":"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","file":"StudyListRouting.bundle.811be4e66c46a9b25776.js","sourcesContent":["class GoogleCloudApi {\n  setAccessToken(accessToken) {\n    if (!accessToken) console.error('Access token is empty');\n    this.accessToken = accessToken;\n  }\n\n  get fetchConfig() {\n    const access_token = this.accessToken || window.access_token;\n    if (!access_token) throw new Error('OIDC access_token is not set');\n    return {\n      method: 'GET',\n      headers: {\n        Authorization: 'Bearer ' + access_token,\n      },\n    };\n  }\n\n  get urlBase() {\n    return this.healthcareApiEndpoint || 'https://healthcare.googleapis.com/v1beta1';\n  }\n\n  set urlBase(url) {\n    this.healthcareApiEndpoint = url;\n  }\n\n  get urlBaseProject() {\n    return this.urlBase + `/projects`;\n  }\n\n  getUrlBaseDicomWeb(project, location, dataset, dicomStore) {\n    return (\n      this.urlBase +\n      `/projects/${project}/locations/${location}/datasets/${dataset}/dicomStores/${dicomStore}/dicomWeb`\n    );\n  }\n\n  getUrlPath(project, location, dataset, dicomStore) {\n    `/projects/${project}/locations/${location}/datasets/${dataset}/dicomStores/${dicomStore}`;\n  }\n\n  async doRequest(urlStr, config = {}, params = {}) {\n    const url = new URL(urlStr);\n    let data = null;\n    url.search = new URLSearchParams(params);\n\n    try {\n      const response = await fetch(url, { ...this.fetchConfig, config });\n      try {\n        data = await response.json();\n      } catch (err) {}\n      if (response.status >= 200 && response.status < 300 && data != null) {\n        if (data.nextPageToken != null) {\n          params.pageToken = data.nextPageToken;\n          let subPage = await this.doRequest(urlStr, config, params);\n          for (let key in data) {\n            if (data.hasOwnProperty(key)) {\n              data[key] = data[key].concat(subPage.data[key]);\n            }\n          }\n        }\n        return {\n          isError: false,\n          status: response.status,\n          data,\n        };\n      } else {\n        return {\n          isError: true,\n          status: response.status,\n          message:\n            (data && data.error && data.error.message) || 'Unknown error',\n        };\n      }\n    } catch (err) {\n      if (data && data.error) {\n        return {\n          isError: true,\n          status: err.status,\n          message: err.response.data.error.message || 'Unspecified error',\n        };\n      }\n      return {\n        isError: true,\n        message: (err && err.message) || 'Oops! Something went wrong',\n      };\n    }\n  }\n\n  async loadProjects() {\n    return this.doRequest(\n      'https://cloudresourcemanager.googleapis.com/v1/projects'\n    );\n  }\n\n  async loadLocations(projectId) {\n    return this.doRequest(`${this.urlBaseProject}/${projectId}/locations`);\n  }\n\n  async loadDatasets(projectId, locationId) {\n    return this.doRequest(\n      `${this.urlBaseProject}/${projectId}/locations/${locationId}/datasets`\n    );\n  }\n\n  async loadDicomStores(dataset) {\n    return this.doRequest(`${this.urlBase}/${dataset}/dicomStores`);\n  }\n}\n\nexport default new GoogleCloudApi();\n","import React, { useEffect, useRef } from 'react';\nexport default function usePrevious(value) {\n  const ref = useRef();\n  useEffect(() => {\n    ref.current = value;\n  }, [value]);\n\n  return ref.current;\n}\n","const getServers = (data, name) => {\n  const {\n    wadoUriRoot,\n    qidoRoot,\n    wadoRoot,\n    dataset = '',\n    dicomStore = '',\n    location = '',\n    project = '',\n  } = data;\n\n  return [\n    {\n      name: name,\n      dataset,\n      dicomStore,\n      location,\n      project,\n      imageRendering: 'wadors',\n      thumbnailRendering: 'wadors',\n      type: 'dicomWeb',\n      active: true,\n      wadoUriRoot,\n      qidoRoot,\n      wadoRoot,\n      supportsFuzzyMatching: false,\n      qidoSupportsIncludeField: false,\n    },\n  ];\n};\n\nconst isValidServer = server => {\n  return (\n    server &&\n    !!server.dataset &&\n    !!server.dicomStore &&\n    !!server.location &&\n    !!server.project\n  );\n};\n\nconst isEqualServer = (server = {}, toCompare = {}) => {\n  const serverLength = Object.keys(server).length;\n  const toCompareLength = Object.keys(toCompare).length;\n\n  if (!serverLength || !toCompareLength) {\n    return false;\n  }\n\n  return (\n    server.dataset === toCompare.dataset &&\n    server.dataset === toCompare.dataset &&\n    server.dicomStore === toCompare.dicomStore &&\n    server.location === toCompare.location &&\n    server.project === toCompare.project\n  );\n};\n\nexport { getServers, isValidServer, isEqualServer };\n","import React, { useContext } from 'react';\nimport GoogleCloudApi from '../googleCloud/api/GoogleCloudApi';\nimport usePrevious from './usePrevious';\n\nimport * as GoogleCloudUtilServers from '../googleCloud/utils/getServers';\nimport { useSelector, useDispatch } from 'react-redux';\nimport isEqual from 'lodash.isequal';\n\n// Contexts\nimport AppContext from '../context/AppContext';\n\nconst getActiveServer = servers => {\n  const isActive = a => a.active === true;\n\n  return servers && servers.servers && servers.servers.find(isActive);\n};\n\nconst getServers = (appConfig, project, location, dataset, dicomStore) => {\n  let servers = [];\n  if (appConfig.enableGoogleCloudAdapter) {\n    GoogleCloudApi.urlBase = appConfig.healthcareApiEndpoint;\n    const pathUrl = GoogleCloudApi.getUrlBaseDicomWeb(\n      project,\n      location,\n      dataset,\n      dicomStore\n    );\n    const data = {\n      project,\n      location,\n      dataset,\n      dicomStore,\n      wadoUriRoot: pathUrl,\n      qidoRoot: pathUrl,\n      wadoRoot: pathUrl,\n    };\n    servers = GoogleCloudUtilServers.getServers(data, dicomStore);\n    if (!isValidServer(servers[0], appConfig)) {\n      return;\n    }\n  }\n\n  return servers;\n};\n\nconst isValidServer = (server, appConfig) => {\n  if (appConfig.enableGoogleCloudAdapter) {\n    return GoogleCloudUtilServers.isValidServer(server);\n  }\n\n  return !!server;\n};\n\nconst setServers = (dispatch, servers) => {\n  const action = {\n    type: 'SET_SERVERS',\n    servers,\n  };\n  dispatch(action);\n};\n\nconst useServerFromUrl = (\n  servers = [],\n  previousServers,\n  activeServer,\n  urlBasedServers,\n  appConfig,\n  project,\n  location,\n  dataset,\n  dicomStore\n) => {\n  // update state from url available only when gcloud on\n  if (!appConfig.enableGoogleCloudAdapter) {\n    return false;\n  }\n\n  const serverHasChanged = previousServers !== servers && previousServers;\n\n  // do not update from url. use state instead.\n  if (serverHasChanged) {\n    return false;\n  }\n\n  // if no valid urlbased servers\n  if (!urlBasedServers || !urlBasedServers.length) {\n    return false;\n  } else if (!servers.length || !activeServer) {\n    // no current valid server\n    return true;\n  }\n\n  const newServer = urlBasedServers[0];\n\n  let exists = servers.some(\n    GoogleCloudUtilServers.isEqualServer.bind(undefined, newServer)\n  );\n\n  return !exists;\n};\n\nexport default function useServer({\n  project,\n  location,\n  dataset,\n  dicomStore,\n} = {}) {\n  // Hooks\n  const servers = useSelector(state => state && state.servers);\n  const previousServers = usePrevious(servers);\n  const dispatch = useDispatch();\n\n  const { appConfig = {} } = useContext(AppContext);\n\n  const activeServer = getActiveServer(servers);\n  const urlBasedServers =\n    getServers(appConfig, project, location, dataset, dicomStore) || [];\n  const shouldUpdateServer = useServerFromUrl(\n    servers.servers,\n    previousServers,\n    activeServer,\n    urlBasedServers,\n    appConfig,\n    project,\n    location,\n    dataset,\n    dicomStore\n  );\n\n  if (shouldUpdateServer) {\n    setServers(dispatch, urlBasedServers);\n  } else if (isValidServer(activeServer, appConfig)) {\n    return activeServer;\n  }\n}\n","export default class FileLoader {\n  fileType;\n  loadFile(file, imageId) { }\n  getDataset(image, imageId) { }\n  getStudies(dataset, imageId) { }\n}\n","import cornerstoneWADOImageLoader from 'cornerstone-wado-image-loader';\nimport FileLoader from './fileLoader';\n\nconst PDFFileLoader = new (class extends FileLoader {\n  fileType = 'application/pdf';\n  loadFile(file, imageId) {\n    return cornerstoneWADOImageLoader.wadouri.loadFileRequest(imageId);\n  }\n\n  getDataset(image, imageId) {\n    const dataset = {};\n    dataset.imageId = image.imageId || imageId;\n    return dataset;\n  }\n\n  getStudies(dataset, imageId) {\n    return this.getDefaultStudy(imageId);\n  }\n\n  getDefaultStudy(imageId) {\n    const study = {\n      StudyInstanceUID: '',\n      StudyDate: '',\n      StudyTime: '',\n      AccessionNumber: '',\n      ReferringPhysicianName: '',\n      PatientName: '',\n      PatientID: '',\n      PatientBirthdate: '',\n      PatientSex: '',\n      StudyId: '',\n      StudyDescription: '',\n      series: [\n        {\n          SeriesInstanceUID: '',\n          SeriesDescription: '',\n          SeriesNumber: '',\n          instances: [\n            {\n              metadata: {\n                SOPInstanceUID: '',\n                SOPClassUID: '1.2.840.10008.5.1.4.1.1.104.1',\n                Rows: '',\n                Columns: '',\n                NumberOfFrames: 0,\n                InstanceNumber: 1,\n              },\n              getImageId: () => imageId,\n              isLocalFile: true,\n            },\n          ],\n        },\n      ],\n    };\n\n    return study;\n  }\n})();\n\nexport default PDFFileLoader;\n","import dcmjs from 'dcmjs';\nimport cornerstoneWADOImageLoader from 'cornerstone-wado-image-loader';\nimport FileLoader from './fileLoader';\nimport OHIF from '@ohif/core';\n\nconst metadataProvider = OHIF.cornerstone.metadataProvider;\n\nconst DICOMFileLoader = new (class extends FileLoader {\n  fileType = 'application/dicom';\n  loadFile(file, imageId) {\n    return cornerstoneWADOImageLoader.wadouri.loadFileRequest(imageId);\n  }\n\n  getDataset(image, imageId) {\n    let dataset = {};\n    try {\n      const dicomData = dcmjs.data.DicomMessage.readFile(image);\n\n      dataset = dcmjs.data.DicomMetaDictionary.naturalizeDataset(\n        dicomData.dict\n      );\n\n      metadataProvider.addInstance(dataset);\n\n      dataset._meta = dcmjs.data.DicomMetaDictionary.namifyDataset(\n        dicomData.meta\n      );\n    } catch (e) {\n      console.error('Error reading dicom file', e);\n    }\n    // Set imageId on dataset to be consumed later on\n    dataset.imageId = imageId;\n\n    return dataset;\n  }\n\n  getStudies(dataset, imageId) {\n    return this.getStudyFromDataset(dataset);\n  }\n\n  getStudyFromDataset(dataset = {}) {\n    const {\n      StudyInstanceUID,\n      StudyDate,\n      StudyTime,\n      AccessionNumber,\n      ReferringPhysicianName,\n      PatientName,\n      PatientID,\n      PatientBirthDate,\n      PatientSex,\n      StudyID,\n      StudyDescription,\n      SeriesInstanceUID,\n      SeriesDescription,\n      SeriesNumber,\n      imageId,\n    } = dataset;\n\n    const instance = {\n      metadata: dataset,\n      url: imageId,\n    };\n\n    const series = {\n      SeriesInstanceUID: SeriesInstanceUID,\n      SeriesDescription: SeriesDescription,\n      SeriesNumber: SeriesNumber,\n      instances: [instance],\n    };\n\n    const study = {\n      StudyInstanceUID,\n      StudyDate,\n      StudyTime,\n      AccessionNumber,\n      ReferringPhysicianName,\n      PatientName,\n      PatientID,\n      PatientBirthDate,\n      PatientSex,\n      StudyID,\n      StudyDescription,\n      /*\n      TODO: in case necessary to uncomment this block, double check every property\n      numberOfStudyRelatedSeries: NumberOfStudyRelatedSeries || DICOMWeb.getString(dataset['00201206']),\n      numberOfStudyRelatedInstances: NumberOfStudyRelatedInstances || DICOMWeb.getString(dataset['00201208']),\n      Modality: Modality || DICOMWeb.getString(dataset['00080060']),\n      ModalitiesInStudy: ModalitiesInStudy || DICOMWeb.getString(dataset['00080061']),\n      modalities:\n      */\n      series: [series],\n    };\n\n    return study;\n  }\n})();\n\nexport default DICOMFileLoader;\n","import cornerstoneWADOImageLoader from 'cornerstone-wado-image-loader';\nimport FileLoader from './fileLoader';\nimport PDFFileLoader from './pdfFileLoader';\nimport DICOMFileLoader from './dicomFileLoader';\n\nclass FileLoaderService extends FileLoader {\n  fileType;\n  loader;\n  constructor(file) {\n    super();\n    const fileType = file && file.type;\n    this.loader = this.getLoader(fileType);\n    this.fileType = this.loader.fileType;\n  }\n\n  static groupSeries(studies) {\n    const groupBy = (list, groupByKey, listKey) => {\n      let nonKeyCounter = 1;\n\n      return list.reduce((acc, obj) => {\n        let key = obj[groupByKey];\n        const list = obj[listKey];\n\n        // in case key not found, group it using counter\n        key = !!key ? key : '' + nonKeyCounter++;\n\n        if (!acc[key]) {\n          acc[key] = { ...obj };\n          acc[key][listKey] = [];\n        }\n\n        acc[key][listKey].push(...list);\n\n        return acc;\n      }, {});\n    };\n\n    const studiesGrouped = Object.values(\n      groupBy(studies, 'StudyInstanceUID', 'series')\n    );\n\n    const result = studiesGrouped.map(studyGroup => {\n      const seriesGrouped = groupBy(\n        studyGroup.series,\n        'SeriesInstanceUID',\n        'instances'\n      );\n      studyGroup.series = Object.values(seriesGrouped);\n\n      return studyGroup;\n    });\n\n    return result;\n  }\n\n  addFile(file) {\n    return cornerstoneWADOImageLoader.wadouri.fileManager.add(file);\n  }\n\n  loadFile(file, imageId) {\n    return this.loader.loadFile(file, imageId);\n  }\n\n  getDataset(image, imageId) {\n    return this.loader.getDataset(image, imageId);\n  }\n\n  getStudies(dataset, imageId) {\n    return this.loader.getStudies(dataset, imageId);\n  }\n\n  getLoader(fileType) {\n    if (fileType === 'application/pdf') {\n      return PDFFileLoader;\n    } else {\n      // Default to dicom loader\n      return DICOMFileLoader;\n    }\n  }\n}\n\nexport default FileLoaderService;\n","import FileLoaderService from './localFileLoaders/fileLoaderService';\n\nconst processFile = async file => {\n  try {\n    const fileLoaderService = new FileLoaderService(file);\n    const imageId = fileLoaderService.addFile(file);\n    const image = await fileLoaderService.loadFile(file, imageId);\n    const dataset = await fileLoaderService.getDataset(image, imageId);\n    const studies = await fileLoaderService.getStudies(dataset, imageId);\n\n    return studies;\n  } catch (error) {\n    console.log(\n      error.name,\n      ':Error when trying to load and process local files:',\n      error.message\n    );\n  }\n};\n\nexport default async function filesToStudies(files) {\n  const processFilesPromises = files.map(processFile);\n  const studies = await Promise.all(processFilesPromises);\n\n  return FileLoaderService.groupSeries(studies.flat());\n}\n","export function formatFileSize(size) {\n  if (size === 0) return '0 B';\n  const n = Math.floor(Math.log(size) / Math.log(1024));\n  return (\n    (size / Math.pow(1024, n)).toFixed(2) * 1 +\n    ' ' +\n    ['B', 'kB', 'MB', 'GB', 'TB'][n]\n  );\n}\n\nexport function httpErrorToStr(error) {\n  if (!error) return 'Unknown error';\n  if (error.response) {\n    try {\n      const jsonResponse = JSON.parse(error.response);\n      if (\n        jsonResponse.error &&\n        jsonResponse.error.code &&\n        jsonResponse.error.message\n      )\n        return jsonResponse.error.code + ' - ' + jsonResponse.error.message;\n    } catch (err) {\n      return error.response;\n    }\n  }\n  return error.message || 'Unknown error.';\n}\n\n/* eslint-disable */\nexport function checkDicomFile(arrayBuffer) {\n  if (arrayBuffer.length <= 132) return false;\n  const arr = new Uint8Array(arrayBuffer.slice(128, 132));\n  // bytes from 128 to 132 must be \"DICM\"\n  return Array.from('DICM').every((char, i) => char.charCodeAt(0) === arr[i]);\n}\n","export default class CancellationToken {\n  constructor() {\n    this.cancelled = false;\n  }\n\n  get() {\n    return this.cancelled;\n  }\n\n  set(value) {\n    this.cancelled = value;\n  }\n}\n","import { httpErrorToStr, checkDicomFile } from '../utils/helpers';\nimport { api } from 'dicomweb-client';\nimport { errorHandler } from '@ohif/core';\n\nclass DicomUploadService {\n  async smartUpload(files, url, uploadCallback, cancellationToken) {\n    const CHUNK_SIZE = 1; // Only one file per request is supported so far\n    const MAX_PARALLEL_JOBS = 50; // FIXME: tune MAX_PARALLEL_JOBS number\n\n    let filesArray = Array.from(files);\n    if (filesArray.length === 0) {\n      throw new Error('No files were provided.');\n    }\n\n    let parallelJobsCount = Math.min(filesArray.length, MAX_PARALLEL_JOBS);\n    let completed = false;\n\n    const processJob = async (resolve, reject) => {\n      while (filesArray.length > 0) {\n        if (cancellationToken.get()) return;\n        let chunk = filesArray.slice(0, CHUNK_SIZE);\n        filesArray = filesArray.slice(CHUNK_SIZE);\n        let error = null;\n        try {\n          if (chunk.length > 1) throw new Error('Not implemented');\n          if (chunk.length === 1) await this.simpleUpload(chunk[0], url);\n        } catch (err) {\n          // It looks like a stupid bug of Babel that err is not an actual Exception object\n          error = httpErrorToStr(err);\n        }\n        chunk.forEach(file => uploadCallback(file.fileId, error));\n        if (!completed && filesArray.length === 0) {\n          completed = true;\n          resolve();\n          return;\n        }\n      }\n    };\n\n    await new Promise(resolve => {\n      for (let i = 0; i < parallelJobsCount; i++) {\n        processJob(resolve);\n      }\n    });\n  }\n\n  async simpleUpload(file, url) {\n    const client = this.getClient(url);\n    const loadedFile = await this.readFile(file);\n    const content = loadedFile.content;\n    if (!checkDicomFile(content))\n      throw new Error('This is not a valid DICOM file.');\n\n    await client.storeInstances({ datasets: [content] });\n  }\n\n  readFile(file) {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      reader.onload = () => {\n        resolve({\n          name: file.name,\n          size: file.size,\n          type: file.type,\n          content: reader.result,\n        });\n      };\n      reader.onerror = error => reject(error);\n      reader.readAsArrayBuffer(file);\n    });\n  }\n\n  setRetrieveAuthHeaderFunction(func) {\n    this.retrieveAuthHeaderFunc = func;\n  }\n\n  getClient(url) {\n    const headers = this.retrieveAuthHeaderFunc();\n    const errorInterceptor = errorHandler.getHTTPErrorHandler();\n\n    // TODO: a bit weird we are creating a new dicomweb client instance for every upload\n    return new api.DICOMwebClient({\n      url,\n      headers,\n    });\n  }\n}\n\nexport default new DicomUploadService();\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { formatFileSize } from './utils/helpers';\nimport CancellationToken from './utils/CancellationToken';\nimport dicomUploader from './api/DicomUploadService';\nimport './DicomUploader.css';\n\nexport default class DicomUploader extends Component {\n  state = {\n    status: 'Upload',\n    isCancelled: false,\n    errorsCount: 0,\n    files: null,\n    uploadedVolume: null,\n    wholeVolumeStr: null,\n    isFilesListHidden: true,\n    timeLeft: null,\n    uploadedList: null,\n    totalCount: 0,\n    successfullyUploadedCount: 0,\n    lastFile: '',\n    uploadContext: null, // this is probably not needed, but we use this variable to distinguish between different downloads\n  };\n\n  static propTypes = {\n    id: PropTypes.string,\n    event: PropTypes.string,\n    url: PropTypes.string,\n    retrieveAuthHeaderFunction: PropTypes.func,\n  };\n\n  filesLeft() {\n    return (\n      this.state.uploadedList.length + ' of ' + this.state.totalCount + ' files'\n    );\n  }\n\n  volumeLeft() {\n    let left = formatFileSize(this.state.uploadedVolume);\n    return left + ' of ' + this.state.wholeVolumeStr;\n  }\n\n  percents() {\n    return parseInt(\n      (100 * this.state.uploadedList.length) /\n        Object.keys(this.state.files).length\n    );\n  }\n\n  isFinished() {\n    return (\n      this.state.isCancelled ||\n      Object.keys(this.state.files).length === this.state.uploadedList.length\n    );\n  }\n\n  errorsMessage() {\n    const errors = this.state.errorsCount === 1 ? ' error' : ' errors';\n    return (\n      this.state.errorsCount + errors + ' while uploading, click for more info'\n    );\n  }\n\n  uploadFiles = files => {\n    const filesArray = Array.from(files.target.files);\n    const filesDict = {};\n    filesArray.forEach((file, i) => {\n      const fileDesc = {\n        id: i,\n        name: file.name,\n        path: file.webkitRelativePath || file.name,\n        size: file.size,\n        error: null,\n        processed: false,\n        processedInUI: false,\n      };\n      filesDict[i] = fileDesc;\n      file.fileId = i;\n    });\n    const wholeVolume = filesArray.map(f => f.size).reduce((a, b) => a + b);\n    const uploadContext = Math.random();\n    this.setState({\n      status: 'Uploading...',\n      files: filesDict,\n      uploadedList: [],\n      uploadedVolume: 0,\n      lastFile: filesArray[0].name,\n      totalCount: filesArray.length,\n      wholeVolumeStr: formatFileSize(wholeVolume),\n      uploadContext: uploadContext,\n      cancellationToken: new CancellationToken(),\n    });\n    const cancellationToken = new CancellationToken();\n    const uploadCallback = (fileId, error) =>\n      uploadContext === this.state.uploadContext &&\n      this.uploadCallback.call(this, fileId, error);\n\n    dicomUploader.setRetrieveAuthHeaderFunction(this.props.retrieveAuthHeaderFunction);\n\n    dicomUploader.smartUpload(\n      files.target.files,\n      this.props.url,\n      uploadCallback,\n      cancellationToken\n    );\n  };\n\n  uploadCallback(fileId, error) {\n    const file = this.state.files[fileId];\n    file.processed = true;\n    if (!error) {\n      let uploadedVolume = this.state.uploadedVolume + file.size;\n      this.setState({ uploadedVolume });\n    } else {\n      file.error = error;\n      this.setState({ errorsCount: this.state.errorsCount + 1 });\n    }\n    this.setState({ lastFile: file.name });\n    let uploadedList = this.state.uploadedList;\n    uploadedList.push(file);\n    this.setState({ uploadedList });\n  }\n\n  renderTableRow = file => {\n    let error = null;\n    if (file.error !== null) {\n      error = <p style={{ color: 'red' }}>{file.error}</p>;\n    }\n    return (\n      <tr key={file.id}>\n        <td className=\"project\">\n          {file.name} {error}\n        </td>\n      </tr>\n    );\n  };\n\n  render() {\n    if (this.state.files === null) {\n      return (\n        <div className=\"dicom-uploader\">\n          <div className=\"button\">\n            <label htmlFor=\"file\">\n              <img src=\"./assets/Button_File.svg\" alt=\"upload file\"></img>\n            </label>\n            <input\n              className=\"invisible-input\"\n              onChange={this.uploadFiles}\n              type=\"file\"\n              id=\"file\"\n              multiple\n            />\n          </div>\n\n          <div className=\"button\">\n            <label htmlFor=\"folder\">\n              <img src=\"./assets/Button_Folder.svg\" alt=\"upload folder\"></img>\n            </label>\n            <input\n              className=\"invisible-input\"\n              type=\"file\"\n              onChange={this.uploadFiles}\n              id=\"folder\"\n              webkitdirectory=\"true\"\n              mozdirectory=\"true\"\n              multiple\n            />\n          </div>\n        </div>\n      );\n    }\n\n    return (\n      <table id=\"tblProjectList\" className=\"table noselect\">\n        <thead>\n          <tr>\n            <th className=\"table-header\">\n              {this.percents()}% {this.filesLeft()}\n            </th>\n          </tr>\n        </thead>\n        <tbody id=\"ProjectList\">\n          {this.state.uploadedList.map(this.renderTableRow)}\n        </tbody>\n      </table>\n    );\n  }\n}\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport DicomUploader from './DicomUploader';\nimport { withTranslation } from 'react-i18next';\nimport { servicesManager } from './../App.js';\n\nfunction DicomFileUploaderModal({\n                                 isOpen = false,\n                                 onClose,\n                                 url,\n                                 retrieveAuthHeaderFunction,\n                                 t,\n                               }) {\n  const { UIModalService } = servicesManager.services;\n\n  const showDicomStorePickerModal = () => {\n    if (!UIModalService) {\n      return\n    }\n\n    UIModalService.show({\n      content: DicomUploader,\n      title: t('Upload DICOM Files'),\n      contentProps: {\n        url,\n        retrieveAuthHeaderFunction\n      },\n      onClose,\n    });\n  };\n\n  return (\n    <React.Fragment>{isOpen && showDicomStorePickerModal()}</React.Fragment>\n  );\n}\n\nDicomFileUploaderModal.propTypes = {\n  isOpen: PropTypes.bool.isRequired,\n  retrieveAuthHeaderFunction: PropTypes.func.isRequired,\n  onClose: PropTypes.func,\n  url: PropTypes.string,\n};\n\nexport default withTranslation('Common')(DicomFileUploaderModal);\n","import { connect } from 'react-redux';\nimport DicomFileUploaderModal from './DicomFileUploaderModal.js';\nimport OHIF from '@ohif/core';\n\nconst isActive = a => a.active === true;\n\nconst mapStateToProps = state => {\n  const activeServer = state.servers.servers.find(isActive);\n\n  // TODO: Not sure I like this approach since it means we are recreating\n  // this function every time redux changes\n  const retrieveAuthHeaderFunction = () =>\n    OHIF.DICOMWeb.getAuthorizationHeader(activeServer);\n\n  return {\n    retrieveAuthHeaderFunction,\n    url: activeServer && activeServer.qidoRoot,\n  };\n};\n\nconst ConnectedDicomFileUploader = connect(\n  mapStateToProps,\n  null\n)(DicomFileUploaderModal);\n\nexport default ConnectedDicomFileUploader;\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport './googleCloud.css';\nimport { withTranslation } from 'react-i18next';\nimport { Icon } from '@ohif/ui';\n\nclass DicomStoreList extends Component {\n  state = {\n    search: '',\n  };\n\n  static propTypes = {\n    stores: PropTypes.array,\n    loading: PropTypes.bool.isRequired,\n    error: PropTypes.string,\n    onSelect: PropTypes.func,\n  };\n\n  static defaultProps = {\n    loading: true,\n  };\n\n  renderTableRow = store => {\n    return (\n      <tr\n        key={store.name}\n        className={\n          this.state.highlightedItem === store.name\n            ? 'noselect active'\n            : 'noselect'\n        }\n        onMouseEnter={() => {\n          this.onHighlightItem(store.name);\n        }}\n        onClick={() => {\n          this.props.onSelect(store);\n        }}\n      >\n        <td className=\"project\">{store.name.split('/')[7]}</td>\n      </tr>\n    );\n  };\n\n  onHighlightItem(store) {\n    this.setState({ highlightedItem: store });\n  }\n\n  render() {\n    const { loading, stores, filter, error } = this.props;\n\n    if (error) {\n      return <p>{error}</p>;\n    }\n\n    const loadingIcon = (\n      <Icon name=\"circle-notch\" className=\"loading-icon-spin loading-icon\" />\n    );\n\n    if (loading) {\n      return loadingIcon;\n    }\n\n    const body = (\n      <tbody id=\"StoreList\">{\n        stores.filter(store => (store.name.split('/')[7].toLowerCase().includes(filter.toLowerCase()) || filter==\"\")).map(this.renderTableRow)}\n      </tbody>\n    );\n\n    return (\n      <table id=\"tblStoreList\" className=\"gcp-table table noselect\">\n        <thead>\n          <tr>\n            <th>{this.props.t('DICOM Store')}</th>\n          </tr>\n        </thead>\n        {stores && body}\n      </table>\n    );\n  }\n}\n\nexport default withTranslation('Common')(DicomStoreList);\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport api from './api/GoogleCloudApi';\nimport DicomStoreList from './DicomStoreList';\nimport './googleCloud.css';\n\nexport default class DicomStorePicker extends Component {\n  state = {\n    error: null,\n    loading: true,\n    stores: [],\n    locations: [],\n    filterStr: '',\n  };\n\n  static propTypes = {\n    dataset: PropTypes.object,\n    onSelect: PropTypes.func,\n    accessToken: PropTypes.string.isRequired,\n  };\n\n  async componentDidMount() {\n    api.setAccessToken(this.props.accessToken);\n\n    const response = await api.loadDicomStores(this.props.dataset.name);\n\n    if (response.isError) {\n      this.setState({\n        error: response.message,\n      });\n\n      return;\n    }\n\n    this.setState({\n      stores: response.data.dicomStores || [],\n      loading: false,\n    });\n  }\n\n  render() {\n    const { stores, loading, error, filterStr } = this.state;\n    const { onSelect } = this.props;\n\n    return (\n      <div>\n        <input\n          className=\"form-control gcp-input\"\n          type=\"text\"\n          value={filterStr}\n          onChange={e => this.setState({ filterStr: e.target.value })}\n        />\n        <DicomStoreList\n          stores={stores}\n          loading={loading}\n          error={error}\n          filter={filterStr}\n          onSelect={onSelect}\n        />\n      </div>\n    );\n  }\n}\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport './googleCloud.css';\nimport { withTranslation } from 'react-i18next';\nimport { Icon } from '@ohif/ui';\n\nclass DatasetsList extends Component {\n  state = {\n    search: '',\n  };\n\n  static propTypes = {\n    datasets: PropTypes.array,\n    loading: PropTypes.bool,\n    error: PropTypes.string,\n    onSelect: PropTypes.func,\n  };\n\n  static defaultProps = {\n    loading: true,\n  };\n\n  renderTableRow = dataset => {\n    return (\n      <tr\n        key={dataset.name}\n        className={\n          this.state.highlightedItem === dataset.name\n            ? 'noselect active'\n            : 'noselect'\n        }\n        onMouseEnter={() => {\n          this.onHighlightItem(dataset.name);\n        }}\n        onClick={() => {\n          this.props.onSelect(dataset);\n        }}\n      >\n        <td>{dataset.name.split('/')[5]}</td>\n      </tr>\n    );\n  };\n\n  onHighlightItem(dataset) {\n    this.setState({ highlightedItem: dataset });\n  }\n\n  render() {\n    const { loading, datasets, filter, error } = this.props;\n    \n    if (error) {\n      return <p>{error}</p>;\n    }\n\n    const loadingIcon = (\n      <Icon name=\"circle-notch\" className=\"loading-icon-spin loading-icon\" />\n    );\n\n    if (loading) {\n      return loadingIcon;\n    }\n\n    const body = (\n      <tbody id=\"DatasetList\">\n        {datasets.filter(dataset => (dataset.name.split('/')[5].toLowerCase().includes(filter.toLowerCase()) || filter==\"\")).map(this.renderTableRow)}\n      </tbody>\n    );\n\n    return (\n      <table id=\"tblDatasetList\" className=\"gcp-table table noselect\">\n        <thead>\n          <tr>\n            <th>{this.props.t('Dataset')}</th>\n          </tr>\n        </thead>\n        {datasets && body}\n      </table>\n    );\n  }\n}\n\nexport default withTranslation('Common')(DatasetsList);\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport api from './api/GoogleCloudApi';\nimport DatasetsList from './DatasetsList';\nimport './googleCloud.css';\n\nexport default class DatasetPicker extends Component {\n  state = {\n    error: null,\n    loading: true,\n    datasets: [],\n    filterStr: '',\n  };\n\n  static propTypes = {\n    project: PropTypes.object,\n    location: PropTypes.object,\n    onSelect: PropTypes.func,\n    accessToken: PropTypes.string,\n  };\n\n  async componentDidMount() {\n    api.setAccessToken(this.props.accessToken);\n\n    const response = await api.loadDatasets(\n      this.props.project.projectId,\n      this.props.location.locationId\n    );\n\n    if (response.isError) {\n      this.setState({\n        error: response.message,\n      });\n\n      return;\n    }\n\n    this.setState({\n      datasets: response.data.datasets || [],\n      loading: false,\n    });\n  }\n\n  render() {\n    const { datasets, loading, error, filterStr } = this.state;\n    const { onSelect } = this.props;\n    return (\n      <div>\n        <input\n          className=\"form-control gcp-input\"\n          type=\"text\"\n          value={filterStr}\n          onChange={e => this.setState({ filterStr: e.target.value })}\n        />\n        <DatasetsList\n          datasets={datasets}\n          loading={loading}\n          error={error}\n          filter={filterStr}\n          onSelect={onSelect}\n        />\n      </div>\n    );\n  }\n}\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport './googleCloud.css';\nimport { withTranslation } from 'react-i18next';\nimport { Icon } from '@ohif/ui';\n\nclass ProjectsList extends Component {\n  state = {\n    search: '',\n    highlightedItem: null,\n  };\n\n  static propTypes = {\n    projects: PropTypes.array,\n    loading: PropTypes.bool.isRequired,\n    error: PropTypes.string,\n    onSelect: PropTypes.func.isRequired,\n    t: PropTypes.func,\n  };\n\n  static defaultProps = {\n    loading: true,\n  };\n\n  renderTableRow = project => {\n    return (\n      <tr\n        key={project.projectId}\n        className={\n          this.state.highlightedItem === project.projectId\n            ? 'noselect active'\n            : 'noselect'\n        }\n        onMouseEnter={() => {\n          this.onHighlightItem(project.projectId);\n        }}\n        onClick={() => {\n          this.onHighlightItem(project.projectId);\n          this.props.onSelect(project);\n        }}\n      >\n        <td>{project.name}</td>\n        <td>{project.projectId}</td>\n      </tr>\n    );\n  };\n\n  onHighlightItem(project) {\n    this.setState({ highlightedItem: project });\n  }\n\n  render() {\n    const { loading, projects, filter, error } = this.props;\n\n    if (error) {\n      return <p>{error}</p>;\n    }\n\n    const loadingIcon = (\n      <Icon name=\"circle-notch\" className=\"loading-icon-spin loading-icon\" />\n    );\n\n    if (loading) {\n      return loadingIcon;\n    }\n\n    const lowerCaseFilter = filter.toLowerCase();\n    const filteredProjects = projects.filter(project =>   \n      typeof project.name  === 'string' &&\n      (filter === \"\" || project.name.toLowerCase().includes(lowerCaseFilter))\n    );\n\n    const body = (\n      <tbody id=\"ProjectList\">\n        {\n          filteredProjects.map(this.renderTableRow)\n        }\n      </tbody>\n    );\n\n    return (\n      <table id=\"tblProjectList\" className=\"gcp-table table noselect\">\n        <thead>\n          <tr>\n            <th>{this.props.t('Project')}</th>\n            <th>{this.props.t('ID')}</th>\n          </tr>\n        </thead>\n        {projects && body}\n      </table>\n    );\n  }\n}\n\nexport default withTranslation('Common')(ProjectsList);\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport api from './api/GoogleCloudApi';\nimport ProjectsList from './ProjectsList';\nimport './googleCloud.css';\n\nexport default class ProjectPicker extends Component {\n  state = {\n    error: null,\n    loading: true,\n    projects: [],\n  };\n\n  static propTypes = {\n    onSelect: PropTypes.func,\n    accessToken: PropTypes.string,\n  };\n\n  async componentDidMount() {\n    api.setAccessToken(this.props.accessToken);\n    /*\n    const response = await api.loadProjects();\n\n    if (response.isError) {\n      this.setState({\n        error: response.message,\n      });\n\n      return;\n    }\n    */\n\n    var project = {\n      name: \"project\",\n      projectId: window.projectId\n    };\n\n    this.setState({\n      projects: [project], //response.data.projects || [],\n      filterStr: '',\n      loading: false,\n    });\n  }\n\n  render() {\n    const { projects, loading, filterStr, error } = this.state;\n    const { onSelect } = this.props;\n    return (\n      <div>\n        <input\n          className=\"form-control gcp-input\"\n          type=\"text\"\n          value={filterStr}\n          onChange={e => this.setState({ filterStr: e.target.value })}\n        />\n        <ProjectsList\n          projects={projects}\n          loading={loading}\n          filter={filterStr}\n          error={error}\n          onSelect={onSelect}\n        />\n      </div>\n    );\n  }\n}\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport './googleCloud.css';\nimport { withTranslation } from 'react-i18next';\nimport { Icon } from '@ohif/ui';\n\nclass LocationsList extends Component {\n  state = {\n    search: '',\n  };\n\n  static propTypes = {\n    locations: PropTypes.array,\n    loading: PropTypes.bool.isRequired,\n    error: PropTypes.string,\n    onSelect: PropTypes.func,\n  };\n\n  static defaultProps = {\n    loading: true,\n  };\n\n  renderTableRow = location => {\n    return (\n      <tr\n        key={location.locationId}\n        className={\n          this.state.highlightedItem === location.locationId\n            ? 'noselect active'\n            : 'noselect'\n        }\n        onMouseEnter={() => {\n          this.onHighlightItem(location.locationId);\n        }}\n        onClick={() => {\n          this.props.onSelect(location);\n        }}\n      >\n        <td>{location.name.split('/')[3]}</td>\n      </tr>\n    );\n  };\n\n  onHighlightItem(locationId) {\n    this.setState({ highlightedItem: locationId });\n  }\n\n  render() {\n    const { loading, locations, filter, error } = this.props;\n\n    if (error) {\n      return <p>{error}</p>;\n    }\n\n    const loadingIcon = (\n      <Icon name=\"circle-notch\" className=\"loading-icon-spin loading-icon\" />\n    );\n\n    if (loading) {\n      return loadingIcon;\n    }\n\n    const body = (\n      <tbody id=\"LocationList\">\n        {locations.filter(location => (location.name.split('/')[3].toLowerCase().includes(filter.toLowerCase()) || filter==\"\")).map(this.renderTableRow)}\n      </tbody>\n    );\n\n    return (\n      <table id=\"tblLocationList\" className=\"gcp-table table noselect\">\n        <thead>\n          <tr>\n            <th>{this.props.t('Location')}</th>\n          </tr>\n        </thead>\n        {locations && body}\n      </table>\n    );\n  }\n}\n\nexport default withTranslation('Common')(LocationsList);\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport api from './api/GoogleCloudApi';\nimport LocationsList from './LocationsList';\nimport './googleCloud.css';\n\nexport default class LocationPicker extends Component {\n  state = {\n    error: null,\n    loading: true,\n    locations: [],\n    filterStr: '',\n  };\n\n  static propTypes = {\n    project: PropTypes.object,\n    onSelect: PropTypes.func,\n    accessToken: PropTypes.string,\n  };\n\n  async componentDidMount() {\n    api.setAccessToken(this.props.accessToken);\n\n    const response = await api.loadLocations(this.props.project.projectId);\n\n    if (response.isError) {\n      this.setState({\n        error: response.message,\n      });\n\n      return;\n    }\n\n    this.setState({\n      locations: response.data.locations || [],\n      loading: false,\n    });\n  }\n\n  render() {\n    const { locations, loading, error, filterStr } = this.state;\n    const { onSelect } = this.props;\n    return (\n      <div>\n        <input\n          className=\"form-control gcp-input\"\n          type=\"text\"\n          value={filterStr}\n          onChange={e => this.setState({ filterStr: e.target.value })}\n        />\n        <LocationsList\n          locations={locations}\n          loading={loading}\n          error={error}\n          filter={filterStr}\n          onSelect={onSelect}\n        />\n      </div>\n    );\n  }\n}\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { withTranslation } from 'react-i18next';\nimport DicomStorePicker from './DicomStorePicker';\nimport DatasetPicker from './DatasetPicker';\nimport ProjectPicker from './ProjectPicker';\nimport LocationPicker from './LocationPicker';\nimport GoogleCloudApi from './api/GoogleCloudApi';\nimport './googleCloud.css';\n\nclass DatasetSelector extends Component {\n  state = {\n    project: null,\n    location: null,\n    dataset: null,\n    unloading: false,\n  };\n\n  static propTypes = {\n    id: PropTypes.string,\n    event: PropTypes.string,\n    user: PropTypes.object,\n    canClose: PropTypes.string,\n    setServers: PropTypes.func.isRequired,\n  };\n\n  onProjectSelect = project => {\n    this.setState({\n      project,\n    });\n  };\n\n  onLocationSelect = location => {\n    this.setState({\n      location,\n    });\n  };\n\n  onDatasetSelect = dataset => {\n    this.setState({\n      dataset,\n    });\n  };\n\n  onProjectClick = () => {\n    this.setState({\n      dataset: null,\n      location: null,\n      project: null,\n    });\n  };\n\n  onLocationClick = () => {\n    this.setState({\n      dataset: null,\n      location: null,\n    });\n  };\n\n  onDatasetClick = () => {\n    this.setState({\n      dataset: null,\n    });\n  };\n\n  onDicomStoreSelect = dicomStoreJson => {\n    const dicomStore = dicomStoreJson.name;\n    const parts = dicomStore.split('/');\n    const result = {\n      wadoUriRoot: GoogleCloudApi.urlBase + `/${dicomStore}/dicomWeb`,\n      qidoRoot: GoogleCloudApi.urlBase + `/${dicomStore}/dicomWeb`,\n      wadoRoot: GoogleCloudApi.urlBase + `/${dicomStore}/dicomWeb`,\n      project: parts[1],\n      location: parts[3],\n      dataset: parts[5],\n      dicomStore: parts[7],\n    };\n    this.props.setServers(result);\n  };\n\n  render() {\n    const accessToken =\n      this.props.user ? this.props.user.access_token : window.access_token;\n\n    const { project, location, dataset } = this.state;\n    const {\n      onProjectClick,\n      onLocationClick,\n      onDatasetClick,\n      onProjectSelect,\n      onLocationSelect,\n      onDatasetSelect,\n      onDicomStoreSelect,\n    } = this;\n\n    let projectBreadcrumbs = (\n      <div className=\"gcp-picker--path\">\n        <span>{this.props.t('Select a Project')}</span>\n      </div>\n    );\n\n    if (project) {\n      projectBreadcrumbs = (\n        <div className=\"gcp-picker--path\">\n          <span onClick={onProjectClick}>{project.name}</span>\n          {project && location && (\n            <span onClick={onLocationClick}>\n              {' '}\n              -> {location.name.split('/')[3]}\n            </span>\n          )}\n          {project && location && dataset && (\n            <span onClick={onDatasetClick}>\n              {' '}\n              -> {dataset.name.split('/')[5]}\n            </span>\n          )}\n        </div>\n      );\n    }\n\n    return (\n      <>\n        {projectBreadcrumbs}\n        {!project && (\n          <ProjectPicker accessToken={accessToken} onSelect={onProjectSelect} />\n        )}\n\n        {project && !location && (\n          <LocationPicker\n            accessToken={accessToken}\n            project={project}\n            onSelect={onLocationSelect}\n          />\n        )}\n        {project && location && !dataset && (\n          <DatasetPicker\n            accessToken={accessToken}\n            project={project}\n            location={location}\n            onSelect={onDatasetSelect}\n          />\n        )}\n        {project && location && dataset && (\n          <DicomStorePicker\n            accessToken={accessToken}\n            dataset={dataset}\n            onSelect={onDicomStoreSelect}\n          />\n        )}\n      </>\n    );\n  }\n}\n\nexport default withTranslation('Common')(DatasetSelector);\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport DatasetSelector from './DatasetSelector';\nimport './googleCloud.css';\nimport { withTranslation } from 'react-i18next';\nimport * as GoogleCloudUtilServers from './utils/getServers';\n\nimport { servicesManager } from './../App.js';\n\nfunction DicomStorePickerModal({\n  isOpen = false,\n  setServers,\n  onClose,\n  user,\n  url,\n  t,\n}) {\n  const { UIModalService } = servicesManager.services;\n\n  const showDicomStorePickerModal = () => {\n    const handleEvent = data => {\n      const servers = GoogleCloudUtilServers.getServers(data, data.dicomstore);\n      setServers(servers);\n\n      // Force auto close\n      UIModalService.hide();\n      onClose();\n    };\n\n    if (UIModalService) {\n      UIModalService.show({\n        content: DatasetSelector,\n        title: t('Google Cloud Healthcare API'),\n        contentProps: {\n          setServers: handleEvent,\n          user,\n          url,\n        },\n        onClose\n      });\n    }\n  };\n\n  return (\n    <React.Fragment>{isOpen && showDicomStorePickerModal()}</React.Fragment>\n  );\n}\n\nDicomStorePickerModal.propTypes = {\n  isOpen: PropTypes.bool.isRequired,\n  setServers: PropTypes.func.isRequired,\n  onClose: PropTypes.func,\n  user: PropTypes.object.isRequired,\n  url: PropTypes.string,\n};\n\nexport default withTranslation('Common')(DicomStorePickerModal);\n","import { connect } from 'react-redux';\nimport DicomStorePickerModal from './DicomStorePickerModal.js';\n\nconst isActive = a => a.active === true;\n\nconst mapStateToProps = state => {\n  const activeServer = state.servers.servers.find(isActive);\n\n  return {\n    user: state.oidc && state.oidc.user,\n    url: activeServer && activeServer.qidoRoot,\n  };\n};\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    setServers: servers => {\n      const action = {\n        type: 'SET_SERVERS',\n        servers,\n      };\n      dispatch(action);\n    },\n  };\n};\n\nconst ConnectedDicomStorePicker = connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(DicomStorePickerModal);\n\nexport default ConnectedDicomStorePicker;\n","import React, { useState, useEffect, useContext } from 'react';\nimport PropTypes from 'prop-types';\nimport OHIF from '@ohif/core';\nimport { withRouter } from 'react-router-dom';\nimport { useTranslation } from 'react-i18next';\nimport {\n  StudyList,\n  PageToolbar,\n  TablePagination,\n  useDebounce,\n  useMedia,\n} from '@ohif/ui';\nimport ConnectedHeader from '../connectedComponents/ConnectedHeader.js';\nimport * as RoutesUtil from '../routes/routesUtil';\nimport moment from 'moment';\nimport ConnectedDicomFilesUploader from '../googleCloud/ConnectedDicomFilesUploader';\nimport ConnectedDicomStorePicker from '../googleCloud/ConnectedDicomStorePicker';\nimport filesToStudies from '../lib/filesToStudies.js';\n\n// Contexts\nimport UserManagerContext from '../context/UserManagerContext';\nimport WhiteLabelingContext from '../context/WhiteLabelingContext';\nimport AppContext from '../context/AppContext';\n\nconst { urlUtil: UrlUtil } = OHIF.utils;\n\nfunction StudyListRoute(props) {\n  const { history, server, user, studyListFunctionsEnabled } = props;\n  const [t] = useTranslation('Common');\n  // ~~ STATE\n  const [sort, setSort] = useState({\n    fieldName: 'PatientName',\n    direction: 'desc',\n  });\n  const [filterValues, setFilterValues] = useState({\n    studyDateTo: null,\n    studyDateFrom: null,\n    PatientName: '',\n    PatientID: '',\n    AccessionNumber: '',\n    StudyDate: '',\n    modalities: '',\n    StudyDescription: '',\n    //\n    patientNameOrId: '',\n    accessionOrModalityOrDescription: '',\n    //\n    allFields: '',\n  });\n  const [studies, setStudies] = useState([]);\n  const [searchStatus, setSearchStatus] = useState({\n    isSearchingForStudies: false,\n    error: null,\n  });\n  const [activeModalId, setActiveModalId] = useState(null);\n  const [rowsPerPage, setRowsPerPage] = useState(25);\n  const [pageNumber, setPageNumber] = useState(0);\n  const appContext = useContext(AppContext);\n  // ~~ RESPONSIVE\n  const displaySize = useMedia(\n    [\n      '(min-width: 1750px)',\n      '(min-width: 1000px) and (max-width: 1749px)',\n      '(max-width: 999px)',\n    ],\n    ['large', 'medium', 'small'],\n    'small'\n  );\n  // ~~ DEBOUNCED INPUT\n  const debouncedSort = useDebounce(sort, 200);\n  const debouncedFilters = useDebounce(filterValues, 250);\n\n  // Google Cloud Adapter for DICOM Store Picking\n  const { appConfig = {} } = appContext;\n  const isGoogleCHAIntegrationEnabled =\n    !server && appConfig.enableGoogleCloudAdapter;\n  if (isGoogleCHAIntegrationEnabled && activeModalId !== 'DicomStorePicker') {\n    setActiveModalId('DicomStorePicker');\n  }\n\n  // Called when relevant state/props are updated\n  // Watches filters and sort, debounced\n  useEffect(\n    () => {\n      const fetchStudies = async () => {\n        try {\n          setSearchStatus({ error: null, isSearchingForStudies: true });\n\n          const response = await getStudyList(\n            server,\n            debouncedFilters,\n            debouncedSort,\n            rowsPerPage,\n            pageNumber,\n            displaySize\n          );\n\n          setStudies(response);\n          setSearchStatus({ error: null, isSearchingForStudies: false });\n        } catch (error) {\n          console.warn(error);\n          setSearchStatus({ error: true, isFetching: false });\n        }\n      };\n\n      if (server) {\n        fetchStudies();\n      }\n    },\n    // TODO: Can we update studies directly?\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [\n      debouncedFilters,\n      debouncedSort,\n      rowsPerPage,\n      pageNumber,\n      displaySize,\n      server,\n    ]\n  );\n\n  // TODO: Update Server\n  // if (this.props.server !== prevProps.server) {\n  //   this.setState({\n  //     modalComponentId: null,\n  //     searchData: null,\n  //     studies: null,\n  //   });\n  // }\n\n  const onDrop = async acceptedFiles => {\n    try {\n      const studiesFromFiles = await filesToStudies(acceptedFiles);\n      setStudies(studiesFromFiles);\n    } catch (error) {\n      setSearchStatus({ isSearchingForStudies: false, error });\n    }\n  };\n\n  if (searchStatus.error) {\n    return <div>Error: {JSON.stringify(searchStatus.error)}</div>;\n  } else if (studies === [] && !activeModalId) {\n    return <div>Loading...</div>;\n  }\n\n  let healthCareApiButtons = null;\n  let healthCareApiWindows = null;\n\n  if (appConfig.enableGoogleCloudAdapter) {\n    const isModalOpen = activeModalId === 'DicomStorePicker';\n    updateURL(isModalOpen, appConfig, server, history);\n\n    healthCareApiWindows = (\n      <ConnectedDicomStorePicker\n        isOpen={activeModalId === 'DicomStorePicker'}\n        onClose={() => setActiveModalId(null)}\n      />\n    );\n\n    healthCareApiButtons = (\n      <div\n        className=\"form-inline btn-group pull-right\"\n        style={{ padding: '20px' }}\n      >\n        <button\n          className=\"btn btn-primary\"\n          onClick={() => setActiveModalId('DicomStorePicker')}\n        >\n          {t('Change DICOM Store')}\n        </button>\n      </div>\n    );\n  }\n\n  function handleSort(fieldName) {\n    let sortFieldName = fieldName;\n    let sortDirection = 'asc';\n\n    if (fieldName === sort.fieldName) {\n      if (sort.direction === 'asc') {\n        sortDirection = 'desc';\n      } else {\n        sortFieldName = null;\n        sortDirection = null;\n      }\n    }\n\n    setSort({\n      fieldName: sortFieldName,\n      direction: sortDirection,\n    });\n  }\n\n  function handleFilterChange(fieldName, value) {\n    setFilterValues(state => {\n      return {\n        ...state,\n        [fieldName]: value,\n      };\n    });\n  }\n\n  return (\n    <>\n      {studyListFunctionsEnabled ? (\n        <ConnectedDicomFilesUploader\n          isOpen={activeModalId === 'DicomFilesUploader'}\n          onClose={() => setActiveModalId(null)}\n        />\n      ) : null}\n      {healthCareApiWindows}\n      <WhiteLabelingContext.Consumer>\n        {whiteLabeling => (\n          <UserManagerContext.Consumer>\n            {userManager => (\n              <ConnectedHeader\n                useLargeLogo={true}\n                user={user}\n                userManager={userManager}\n              >\n                {whiteLabeling &&\n                  whiteLabeling.createLogoComponentFn &&\n                  whiteLabeling.createLogoComponentFn(React)}\n              </ConnectedHeader>\n            )}\n          </UserManagerContext.Consumer>\n        )}\n      </WhiteLabelingContext.Consumer>\n      <div className=\"study-list-header\">\n        <div className=\"header\">\n          <h1 style={{ fontWeight: 300, fontSize: '22px' }}>\n            {t('StudyList')}\n          </h1>\n        </div>\n        <div className=\"actions\">\n          {studyListFunctionsEnabled && healthCareApiButtons}\n          {studyListFunctionsEnabled && (\n            <PageToolbar\n              onImport={() => setActiveModalId('DicomFilesUploader')}\n            />\n          )}\n          <span className=\"study-count\">{studies.length}</span>\n        </div>\n      </div>\n\n      <div className=\"table-head-background\" />\n      <div className=\"study-list-container\">\n        {/* STUDY LIST OR DROP ZONE? */}\n        <StudyList\n          isLoading={searchStatus.isSearchingForStudies}\n          hasError={searchStatus.error === true}\n          // Rows\n          studies={studies}\n          onSelectItem={studyInstanceUID => {\n            const viewerPath = RoutesUtil.parseViewerPath(appConfig, server, {\n              studyInstanceUIDs: studyInstanceUID,\n            });\n            history.push(viewerPath);\n          }}\n          // Table Header\n          sort={sort}\n          onSort={handleSort}\n          filterValues={filterValues}\n          onFilterChange={handleFilterChange}\n          studyListDateFilterNumDays={appConfig.studyListDateFilterNumDays}\n          displaySize={displaySize}\n        />\n        {/* PAGINATION FOOTER */}\n        <TablePagination\n          currentPage={pageNumber}\n          nextPageFunc={() => setPageNumber(pageNumber + 1)}\n          prevPageFunc={() => setPageNumber(pageNumber - 1)}\n          onRowsPerPageChange={Rows => setRowsPerPage(Rows)}\n          rowsPerPage={rowsPerPage}\n          recordCount={studies.length}\n        />\n      </div>\n    </>\n  );\n}\n\nStudyListRoute.propTypes = {\n  filters: PropTypes.object,\n  PatientID: PropTypes.string,\n  server: PropTypes.object,\n  user: PropTypes.object,\n  history: PropTypes.object,\n  studyListFunctionsEnabled: PropTypes.bool,\n};\n\nStudyListRoute.defaultProps = {\n  studyListFunctionsEnabled: true,\n};\n\nfunction updateURL(isModalOpen, appConfig, server, history) {\n  if (isModalOpen) {\n    return;\n  }\n\n  const listPath = RoutesUtil.parseStudyListPath(appConfig, server);\n\n  if (UrlUtil.paramString.isValidPath(listPath)) {\n    const { location = {} } = history;\n    if (location.pathname !== listPath) {\n      history.replace(listPath);\n    }\n  }\n}\n\n/**\n * Not ideal, but we use displaySize to determine how the filters should be used\n * to build the collection of promises we need to fetch a result set.\n *\n * @param {*} server\n * @param {*} filters\n * @param {object} sort\n * @param {string} sort.fieldName - field to sort by\n * @param {string} sort.direction - direction to sort\n * @param {number} rowsPerPage - Number of results to return\n * @param {number} pageNumber - Used to determine results offset\n * @param {string} displaySize - small, medium, large\n * @returns\n */\nasync function getStudyList(\n  server,\n  filters,\n  sort,\n  rowsPerPage,\n  pageNumber,\n  displaySize\n) {\n  const {\n    allFields,\n    patientNameOrId,\n    accessionOrModalityOrDescription,\n  } = filters;\n  const sortFieldName = sort.fieldName || 'PatientName';\n  const sortDirection = sort.direction || 'desc';\n  const studyDateFrom =\n    filters.studyDateFrom ||\n    moment()\n      .subtract(25000, 'days')\n      .toDate();\n  const studyDateTo = filters.studyDateTo || new Date();\n\n  const mappedFilters = {\n    PatientID: filters.PatientID,\n    PatientName: filters.PatientName,\n    AccessionNumber: filters.AccessionNumber,\n    StudyDescription: filters.StudyDescription,\n    ModalitiesInStudy: filters.modalities,\n    // NEVER CHANGE\n    studyDateFrom,\n    studyDateTo,\n    limit: rowsPerPage,\n    offset: pageNumber * rowsPerPage,\n    fuzzymatching: server.supportsFuzzyMatching === true,\n  };\n\n  const studies = await _fetchStudies(server, mappedFilters, displaySize, {\n    allFields,\n    patientNameOrId,\n    accessionOrModalityOrDescription,\n  });\n\n  // Only the fields we use\n  const mappedStudies = studies.map(study => {\n    const PatientName =\n      typeof study.PatientName === 'string' ? study.PatientName : undefined;\n\n    return {\n      AccessionNumber: study.AccessionNumber, // \"1\"\n      modalities: study.modalities, // \"SEG\\\\MR\"  \n      // numberOfStudyRelatedInstances: \"3\"\n      // numberOfStudyRelatedSeries: \"3\"\n      // PatientBirthdate: undefined\n      PatientID: study.PatientID, // \"NOID\"\n      PatientName, // \"NAME^NONE\"\n      // PatientSex: \"M\"\n      // referringPhysicianName: undefined\n      StudyDate: study.StudyDate, // \"Jun 28, 2002\"\n      StudyDescription: study.StudyDescription, // \"BRAIN\"\n      // studyId: \"No Study ID\"\n      StudyInstanceUID: study.StudyInstanceUID, // \"1.3.6.1.4.1.5962.99.1.3814087073.479799962.1489872804257.3.0\"\n      // StudyTime: \"160956.0\"\n    };\n  });\n\n  // For our smaller displays, map our field name to a single\n  // field we can actually sort by.\n  const sortFieldNameMapping = {\n    allFields: 'PatientName',\n    patientNameOrId: 'PatientName',\n    accessionOrModalityOrDescription: 'modalities',\n  };\n  const mappedSortFieldName =\n    sortFieldNameMapping[sortFieldName] || sortFieldName;\n\n  const sortedStudies = _sortStudies(\n    mappedStudies,\n    mappedSortFieldName,\n    sortDirection\n  );\n\n  // Because we've merged multiple requests, we may have more than\n  // our Rows per page. Let's `take` that number from our sorted array.\n  // This \"might\" cause paging issues.\n  const numToTake =\n    sortedStudies.length < rowsPerPage ? sortedStudies.length : rowsPerPage;\n  const result = sortedStudies.slice(0, numToTake);\n\n  return result;\n}\n\n/**\n *\n *\n * @param {object[]} studies - Array of studies to sort\n * @param {string} studies.StudyDate - Date in 'MMM DD, YYYY' format\n * @param {string} field - name of properties on study to sort by\n * @param {string} order - 'asc' or 'desc'\n * @returns\n */\nfunction _sortStudies(studies, field, order) {\n  // Make sure our StudyDate is in a valid format and create copy of studies array\n  const sortedStudies = studies.map(study => {\n    if (!moment(study.StudyDate, 'MMM DD, YYYY', true).isValid()) {\n      study.StudyDate = moment(study.StudyDate, 'YYYYMMDD').format(\n        'MMM DD, YYYY'\n      );\n    }\n    return study;\n  });\n\n  // Sort by field\n  sortedStudies.sort(function(a, b) {\n    let fieldA = a[field];\n    let fieldB = b[field];\n    if (field === 'StudyDate') {\n      fieldA = moment(fieldA).toISOString();\n      fieldB = moment(fieldB).toISOString();\n    }\n\n    // Order\n    if (order === 'desc') {\n      if (fieldA < fieldB) {\n        return -1;\n      }\n      if (fieldA > fieldB) {\n        return 1;\n      }\n      return 0;\n    } else {\n      if (fieldA > fieldB) {\n        return -1;\n      }\n      if (fieldA < fieldB) {\n        return 1;\n      }\n      return 0;\n    }\n  });\n\n  return sortedStudies;\n}\n\n/**\n * We're forced to do this because DICOMWeb does not support \"AND|OR\" searches\n * across multiple fields. This allows us to make multiple requests, remove\n * duplicates, and return the result set as if it were supported\n *\n * @param {object} server\n * @param {Object} filters\n * @param {string} displaySize - small, medium, or large\n * @param {string} multi.allFields\n * @param {string} multi.patientNameOrId\n * @param {string} multi.accessionOrModalityOrDescription\n */\nasync function _fetchStudies(\n  server,\n  filters,\n  displaySize,\n  { allFields, patientNameOrId, accessionOrModalityOrDescription }\n) {\n  let queryFiltersArray = [filters];\n\n  if (displaySize === 'small') {\n    const firstSet = _getQueryFiltersForValue(\n      filters,\n      [\n        'PatientID',\n        'PatientName',\n        'AccessionNumber',\n        'StudyDescription',\n        'ModalitiesInStudy',\n      ],\n      allFields\n    );\n\n    if (firstSet.length) {\n      queryFiltersArray = firstSet;\n    }\n  } else if (displaySize === 'medium') {\n    const firstSet = _getQueryFiltersForValue(\n      filters,\n      ['PatientID', 'PatientName'],\n      patientNameOrId\n    );\n\n    const secondSet = _getQueryFiltersForValue(\n      filters,\n      ['AccessionNumber', 'StudyDescription', 'ModalitiesInStudy'],\n      accessionOrModalityOrDescription\n    );\n\n    if (firstSet.length || secondSet.length) {\n      queryFiltersArray = firstSet.concat(secondSet);\n    }\n  }\n\n  const queryPromises = [];\n\n  queryFiltersArray.forEach(filter => {\n    const searchStudiesPromise = OHIF.studies.searchStudies(server, filter);\n    queryPromises.push(searchStudiesPromise);\n  });\n\n  const lotsOfStudies = await Promise.all(queryPromises);\n  const studies = [];\n\n  // Flatten and dedupe\n  lotsOfStudies.forEach(arrayOfStudies => {\n    if (arrayOfStudies) {\n      arrayOfStudies.forEach(study => {\n        if (!studies.some(s => s.StudyInstanceUID === study.StudyInstanceUID)) {\n          studies.push(study);\n        }\n      });\n    }\n  });\n\n  return studies;\n}\n\n/**\n *\n *\n * @param {*} filters\n * @param {*} fields - Array of string fields\n * @param {*} value\n */\nfunction _getQueryFiltersForValue(filters, fields, value) {\n  const queryFilters = [];\n\n  if (value === '' || !value) {\n    return queryFilters;\n  }\n\n  fields.forEach(field => {\n    const filter = Object.assign(\n      {\n        PatientID: '',\n        PatientName: '',\n        AccessionNumber: '',\n        StudyDescription: '',\n        ModalitiesInStudy: '',\n      },\n      filters\n    );\n\n    filter[field] = value;\n    queryFilters.push(filter);\n  });\n\n  return queryFilters;\n}\n\nexport default withRouter(StudyListRoute);\n","import { connect } from 'react-redux';\n\nimport StudyListRoute from './StudyListRoute.js';\n\nconst isActive = a => a.active === true;\n\nconst mapStateToProps = state => {\n  const activeServer = state.servers.servers.find(isActive);\n\n  return {\n    server: activeServer,\n    user: state.oidc.user,\n  };\n};\n\nconst ConnectedStudyList = connect(\n  mapStateToProps,\n  null\n)(StudyListRoute);\n\nexport default ConnectedStudyList;\n","import React, { useContext } from 'react';\nimport PropTypes from 'prop-types';\nimport { withRouter } from 'react-router-dom';\nimport ConnectedStudyList from './ConnectedStudyList';\nimport useServer from '../customHooks/useServer';\nimport OHIF from '@ohif/core';\nconst { urlUtil: UrlUtil } = OHIF.utils;\n\n// Contexts\nimport AppContext from '../context/AppContext';\n\nfunction StudyListRouting({ match: routeMatch, location: routeLocation }) {\n  const {\n    project,\n    location,\n    dataset,\n    dicomStore,\n    studyInstanceUIDs,\n    seriesInstanceUIDs,\n  } = routeMatch.params;\n  const server = useServer({ project, location, dataset, dicomStore });\n  const { appConfig = {} } = useContext(AppContext);\n\n  const filters = UrlUtil.queryString.getQueryFilters(routeLocation);\n\n  let studyListFunctionsEnabled = false;\n  if (appConfig.studyListFunctionsEnabled) {\n    studyListFunctionsEnabled = appConfig.studyListFunctionsEnabled;\n  }\n  return (\n    <ConnectedStudyList\n      filters={filters}\n      studyListFunctionsEnabled={studyListFunctionsEnabled}\n    />\n  );\n}\n\nStudyListRouting.propTypes = {\n  location: PropTypes.shape({\n    search: PropTypes.string,\n  }).isRequired,\n};\n\nexport default withRouter(StudyListRouting);\n"],"sourceRoot":""}