(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{1013:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(0);function a(e){var t=Object(r.useRef)();return Object(r.useEffect)((function(){t.current=e}),[e]),t.current}},1017:function(e,t,n){"use strict";var r=n(58),a=n(0),s=n.n(a),o=n(85),i=n(163),u=n(133),c=n(8),l=n(1013),d=n(1019),f=n(1),p=n.n(f),y=n(252),v=n(13),I=n(76),b=n(253);function S(e,t,n,r,a,s,o){try{var i=e[s](o),u=i.value}catch(e){return void n(e)}i.done?t(u):Promise.resolve(u).then(r,a)}function h(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function o(e){S(s,r,a,o,i,"next",e)}function i(e){S(s,r,a,o,i,"throw",e)}o(void 0)}))}}function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,a=!1,s=void 0;try{for(var o,i=e[Symbol.iterator]();!(r=(o=i.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,s=e}finally{try{r||null==i.return||i.return()}finally{if(a)throw s}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function g(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var D=o.a.OHIFStudyMetadata,w=o.a.OHIFSeriesMetadata,U=i.a.retrieveStudiesMetadata,O=i.a.deleteStudyMetadataPromise,j=u.a.studyMetadataManager,R=u.a.makeCancelable,A=function(e,t,n,r){var a=!1;return r||(a=E(e,t,n)),a},E=function(e,t,n){var r,a,s,o,i,u,c,l=!1;if(Object.keys(n).length>0){var d=n.seriesInstanceUID,f=(r=t.getDisplaySets(),a=d,s=function(e,t){return t.SeriesInstanceUID===e},o=g(r),i=[],u=0,(c=a.split(",")).forEach((function(e){var t=o.findIndex(s.bind(void 0,e));if(t>=0){var n=m(o.splice(t,1),1)[0];i[u]=n,u++}})),{promoted:u===c.length,data:[].concat(i,g(o))});e.displaySets=f.data,l=f.promoted}return l},x=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=t.seriesInstanceUID,a=!0;if(!r)return a;var s=r.split(","),o=function(){if(f.length===s.length)return f.every((function(e){return s.some((function(t){return t===e.SeriesInstanceUID}))}))},i=function(){for(var e=!0,t=0;t<s.length;t++){var n=s[t],r=f[t];if(!r||r.SeriesInstanceUID!==n){e=!1;break}}return e},u=e.series,c=void 0===u?[]:u,l=e.displaySets,d=void 0===l?[]:l,f=n?c:d,p=n?o:i;return a=!!f&&p()},C=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e){var r=n.show,a=void 0===r?function(){}:r;a({message:t})}},P=function(e,t){var n=y.c.modules.sopClassHandlerModule,r=e.getData(),a=new w(t,r);e.getSeriesByUID(t.SeriesInstanceUID)?e.updateSeries(t.SeriesInstanceUID,a):e.addSeries(a),e.createAndAddDisplaySetsForSeries(n,a),r.displaySets=e.getDisplaySets(),r.derivedDisplaySets=e.getDerivedDatasets({Modality:t.Modality}),k(r,e)},k=function(e,t){var n=e.StudyInstanceUID;j.get(n)||j.add(t)},M=function(e,t){console.log("_updateStudyDisplaySets"),console.log(e),console.log(t);var n=y.c.modules.sopClassHandlerModule;e.displaySets||(e.displaySets=t.createDisplaySets(n)),e.derivedDisplaySets&&t._addDerivedDisplaySets(e.derivedDisplaySets)},T=function(e){return{StudyInstanceUID:e.StudyInstanceUID,series:e.series.map((function(e){return{SeriesInstanceUID:e.SeriesInstanceUID}}))}};function N(e){var t,n,r=e.server,o=e.studyInstanceUIDs,i=e.seriesInstanceUIDs,u=e.clearViewportSpecificData,f=e.setStudyData,p=e.patientID,y=m(Object(a.useState)(!1),2),S=y[0],w=y[1],E=m(Object(a.useState)([]),2),N=E[0],_=E[1],H=m(Object(a.useState)(!1),2),J=H[0],L=H[1],V=Object(v.K)(),q=Object(a.useContext)(I.c).appConfig,F=void 0===q?{}:q,Q=F.filterQueryParam,W=void 0!==Q&&Q,B=F.maxConcurrentMetadataRequests;console.log("ViewerRetrieveStudyData()"),console.log(o);var G=function(e,n){if(console.log("processStudies"),console.log(e),Array.isArray(e)&&e.length>0){var r=e.filter((function(e){return null!==e})).map((function(e){f(e.StudyInstanceUID,T(e));var r=new D(e,e.StudyInstanceUID);return M(e,r),k(e,r),t[e.StudyInstanceUID]=R(K(r)).then((function(t){t&&!t.isCanceled&&function(e,t,n){A(e,t,n,W)&&u(0);var r=x(e,n,W);C(r,"Query parameters were not totally applied. It might be using original series list for given study.",V),_([].concat(g(N),[e])),L(!0)}(e,r,n)})).catch((function(e){e&&!e.isCanceled&&(w(e),c.a.error(e))})),e}));_(r)}},K=function(){var e=h(regeneratorRuntime.mark((function e(t){var n,r,a,s,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.getData(),r=n.seriesLoader){e.next=3;break}return e.abrupt("return");case 3:return a=function(){var e=h(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.hasNext()){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,r.next();case 4:return n=e.sent,P(t,n),_((function(e){return g(e)})),e.abrupt("return",a());case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),s=B||t.getSeriesCount(),o=Array(s).fill(null).map(a),e.next=8,Promise.all(o);case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),X=function(){var e=h(regeneratorRuntime.mark((function e(){var t,a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("loadStudies()");try{t={},a=i&&i[0],s=[r,o],a&&(t.seriesInstanceUID=a,W&&s.push(t)),(F.splitQueryParameterCalls||F.enableGoogleCloudAdapter)&&s.push(!0),n[o]=R(U.apply(void 0,s)).then((function(e){e&&!e.isCanceled&&G(e,t)})).catch((function(e){e&&!e.isCanceled&&(w(e),c.a.error(e))}))}catch(e){e&&(w(e),c.a.error(e))}case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),$=Object(a.useCallback)((function(){for(var e in n)"cancel"in n[e]&&n[e].cancel();for(var r in t)"cancel"in t[r]&&(t[r].cancel(),O(r),j.remove(r))})),z=Object(l.a)(o),Y=!(z&&z.every((function(e){return o.includes(e)}))&&o.every((function(e){return z.includes(e)})));if(Object(a.useEffect)((function(){Y&&(j.purge(),$())}),[z,$,o]),Object(a.useEffect)((function(){if(Y)return t={},n={},X(),function(){$()}}),[o]),S){var Z=JSON.stringify(S);return Z.includes("404")||Z.includes("NOT_FOUND")?s.a.createElement(b.a,null):s.a.createElement(b.a,{message:"Failed to retrieve study data"})}return s.a.createElement(d.a,{studies:N,isStudyLoaded:J,studyInstanceUIDs:o,patientID:p})}N.propTypes={studyInstanceUIDs:p.a.array.isRequired,seriesInstanceUIDs:p.a.array,server:p.a.object,clearViewportSpecificData:p.a.func.isRequired,setStudyData:p.a.func.isRequired};var _=N,H=n(16).b.redux.actions,J=H.clearViewportSpecificData,L=H.setStudyData,V=function(e){return!0===e.active},q=Object(r.b)((function(e,t){var n=e.servers.servers.find(V);console.log("mapStateToProps for ConnectedViewerRetrieveStudyData"),console.log(e.studies.studyData);var r=Object.keys(e.studies.studyData);return{server:t.server||n,studyInstanceUIDs:r}}),(function(e){return{setStudyData:function(t,n){e(L(t,n))},clearViewportSpecificData:function(){e(J())}}}))(_);t.a=q},1028:function(e,t,n){"use strict";t.decode=t.parse=n(1029),t.encode=t.stringify=n(1030)},1029:function(e,t,n){"use strict";function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,n,s){t=t||"&",n=n||"=";var o={};if("string"!=typeof e||0===e.length)return o;var i=/\+/g;e=e.split(t);var u=1e3;s&&"number"==typeof s.maxKeys&&(u=s.maxKeys);var c=e.length;u>0&&c>u&&(c=u);for(var l=0;l<c;++l){var d,f,p,y,v=e[l].replace(i,"%20"),I=v.indexOf(n);I>=0?(d=v.substr(0,I),f=v.substr(I+1)):(d=v,f=""),p=decodeURIComponent(d),y=decodeURIComponent(f),r(o,p)?a(o[p])?o[p].push(y):o[p]=[o[p],y]:o[p]=y}return o};var a=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},1030:function(e,t,n){"use strict";var r=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,n,i){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?s(o(e),(function(o){var i=encodeURIComponent(r(o))+n;return a(e[o])?s(e[o],(function(e){return i+encodeURIComponent(r(e))})).join(t):i+encodeURIComponent(r(e[o]))})).join(t):i?encodeURIComponent(r(i))+n+encodeURIComponent(r(e)):""};var a=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function s(e,t){if(e.map)return e.map(t);for(var n=[],r=0;r<e.length;r++)n.push(t(e[r],r));return n}var o=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}},997:function(e,t,n){"use strict";n.r(t);var r=n(58),a=n(0),s=n.n(a),o=n(16),i=n(1),u=n.n(i),c=n(1028),l=n.n(c),d=n(252),f=n(1019),p=n(1017),y=n(253);function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function I(e,t,n,r,a,s,o){try{var i=e[s](o),u=i.value}catch(e){return void n(e)}i.done?t(u):Promise.resolve(u).then(r,a)}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var D=o.b.log,w=o.b.metadata,U=o.b.utils.studyMetadataManager,O=w.OHIFStudyMetadata,j=function(e){function t(){var e,n,r,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var s=arguments.length,o=new Array(s),i=0;i<s;i++)o[i]=arguments[i];return r=this,n=!(a=(e=S(t)).call.apply(e,[this].concat(o)))||"object"!==v(a)&&"function"!=typeof a?h(r):a,g(h(n),"state",{studies:null,server:null,studyInstanceUIDs:null,seriesInstanceUIDs:null,error:null,loading:!0}),n}var n,r,a,i,u;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(t,e),n=t,(r=[{key:"parseQueryAndRetrieveDICOMWebData",value:function(e){var t=this;return new Promise((function(n,r){var a=e.url;if(!a)return r(new Error("No URL was specified. Use ?url=$yourURL"));var s=new XMLHttpRequest;s.addEventListener("error",(function(e){D.warn("An error occurred while retrieving the JSON data"),r(e)})),s.addEventListener("load",(function(a){404===a.target.status&&r(new Error("No JSON data found")),s.responseText||(D.warn("Response was undefined"),r(new Error("Response was undefined"))),D.info(JSON.stringify(s.responseText,null,2));var i=JSON.parse(s.responseText);if(i.servers){e.studyInstanceUIDs||(D.warn("No study instance uids specified"),r(new Error("No study instance uids specified")));var u=i.servers.dicomWeb[0];u.type="dicomWeb",D.warn("Activating server",u),t.props.activateServer(u);var c=e.studyInstanceUIDs.split(";"),l=e.seriesInstanceUIDs?e.seriesInstanceUIDs.split(";"):[];n({server:u,studyInstanceUIDs:c,seriesInstanceUIDs:l})}else{var d,f,p=o.b.cornerstone.metadataProvider;i.studies.forEach((function(e){d=e.StudyInstanceUID,e.series.forEach((function(e){f=e.SeriesInstanceUID,e.instances.forEach((function(e){var t=e.url,n=e.metadata;p.addInstance(n),p.addImageIdToUIDs(t,{StudyInstanceUID:d,SeriesInstanceUID:f,SOPInstanceUID:n.SOPInstanceUID})}))}))})),n({studies:i.studies,studyInstanceUIDs:[]})}})),D.info("Sending Request to: ".concat(a)),s.open("GET",a),s.setRequestHeader("Accept","application/json"),s.send()}))}},{key:"componentDidMount",value:(i=regeneratorRuntime.mark((function e(){var t,n,r,a,s,o,i,u,c,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=(t=this.props.location.search).slice(1,t.length),n=l.a.parse(t),e.next=6,this.parseQueryAndRetrieveDICOMWebData(n);case 6:r=e.sent,a=r.server,s=r.studies,o=r.studyInstanceUIDs,i=r.seriesInstanceUIDs,s&&(u=R(s),c=u.studies,d=u.studyInstanceUIDs,s=c,o=d),this.setState({studies:s,server:a,studyInstanceUIDs:o,seriesInstanceUIDs:i,loading:!1}),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),this.setState({error:e.t0.message,loading:!1});case 18:case"end":return e.stop()}}),e,this,[[0,15]])})),u=function(){var e=this,t=arguments;return new Promise((function(n,r){var a=i.apply(e,t);function s(e){I(a,n,r,s,o,"next",e)}function o(e){I(a,n,r,s,o,"throw",e)}s(void 0)}))},function(){return u.apply(this,arguments)})},{key:"render",value:function(){var e=this.state.error?"Error: ".concat(JSON.stringify(this.state.error)):"Loading...";return this.state.error||this.state.loading?s.a.createElement(y.a,{message:e,showGoBackButton:this.state.error}):this.state.studies?s.a.createElement(f.a,{studies:this.state.studies}):s.a.createElement(p.a,{studyInstanceUIDs:this.state.studyInstanceUIDs,seriesInstanceUIDs:this.state.seriesInstanceUIDs,server:this.state.server})}}])&&b(n.prototype,r),a&&b(n,a),t}(a.Component);g(j,"propTypes",{location:u.a.object,store:u.a.object,setServers:u.a.func});var R=function(e){U.purge();var t=new Set;return{studies:e.map((function(e){var n=new O(e,e.StudyInstanceUID),r=d.c.modules.sopClassHandlerModule;return e.displaySets=e.displaySets||n.createDisplaySets(r),U.add(n),t.add(e.StudyInstanceUID),e})),studyInstanceUIDs:Array.from(t)}},A=j,E=Object(r.b)(null,(function(e){return{activateServer:function(t){e({type:"ACTIVATE_SERVER",server:t})}}}))(A);t.default=E}}]);
//# sourceMappingURL=ConnectedStandaloneRouting.bundle.42dda451ef88cf043f41.js.map